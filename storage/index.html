<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Voice TTS - Êô∫ËÉΩËØ≠Èü≥ÂêàÊàêÁ≥ªÁªü</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/antd@5.12.8/dist/reset.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/antd@5.12.8/dist/antd.min.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/dayjs.min.js"></script>
    <style>
        :root {
            --primary-color: #1890ff;
            --success-color: #52c41a;
            --warning-color: #faad14;
            --error-color: #ff4d4f;
            --info-color: #13c2c2;
            --text-color: #262626;
            --text-color-secondary: #8c8c8c;
            --border-color: #d9d9d9;
            --background-color: #f5f5f5;
            --white: #ffffff;
            --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            --border-radius: 6px;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f5f5;
            min-height: 100vh;
            color: var(--text-color);
        }

        .app-container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .app-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 16px 24px;
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .app-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--white);
            margin: 0;
        }

        .app-subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            font-weight: 400;
            margin-top: 4px;
        }

        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* ‰æßËæπÊ†èÊ†∑Âºè */
        .sidebar {
            width: 240px;
            background: var(--white);
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            transition: width 0.3s ease;
        }

        .sidebar.collapsed {
            width: 70px;
        }

        .sidebar-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .collapse-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            transition: background-color 0.2s ease;
            font-size: 16px;
            color: var(--text-color-secondary);
        }

        .collapse-btn:hover {
            background-color: #f5f5f5;
            color: var(--primary-color);
        }

        .menu-list {
            list-style: none;
            padding: 16px 0;
            margin: 0;
        }

        .menu-item {
            padding: 12px 24px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-color);
            font-size: 15px;
            font-weight: 500;
            border-left: 3px solid transparent;
            white-space: nowrap;
            overflow: hidden;
        }

        .sidebar.collapsed .menu-item {
            padding: 12px;
            justify-content: center;
        }

        .menu-item:hover {
            background: #f5f5f5;
        }

        .menu-item.active {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            color: var(--primary-color);
            border-left-color: var(--primary-color);
        }

        .menu-icon {
            font-size: 18px;
            min-width: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .menu-text {
            flex: 1;
            opacity: 1;
            transition: opacity 0.2s ease;
        }

        .sidebar.collapsed .menu-text {
            opacity: 0;
            width: 0;
        }

        /* ÂÜÖÂÆπÂå∫ÂüüÊ†∑Âºè */
        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            background: #f5f5f5;
        }

        .content-panel {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 24px;
            box-shadow: var(--box-shadow);
            min-height: 100%;
        }

        .task-list-container {
            display: flex;
            flex-direction: column;
            gap: 0;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .task-list-header {
            display: grid;
            grid-template-columns: 40px 100px 80px 1fr 80px 600px;
            gap: 12px;
            padding: 10px 16px;
            background: #fafafa;
            font-weight: 600;
            font-size: 12px;
            color: var(--text-color);
            border-bottom: 1px solid var(--border-color);
        }

        @media (max-width: 768px) {
            .task-list-header {
                display: none;
            }
        }

        .saved-audio-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
            gap: 16px;
        }

        @media (max-width: 768px) {
            .saved-audio-list {
                grid-template-columns: 1fr;
            }
        }

        .saved-audio-card {
            background: var(--white);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 16px;
            transition: all 0.2s ease;
        }

        .saved-audio-card:hover {
            box-shadow: var(--box-shadow);
            transform: translateY(-2px);
        }

        .audio-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .audio-card-title {
            font-weight: 600;
            font-size: 16px;
            color: var(--text-color);
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .audio-card-meta {
            font-size: 12px;
            color: var(--text-color-secondary);
            margin-bottom: 12px;
        }

        .audio-card-actions {
            display: flex;
            gap: 4px;
            margin-top: 12px;
            flex-wrap: nowrap;
            justify-content: flex-start;
            align-items: center;
        }

        .audio-card-player {
            width: 100%;
            margin-top: 8px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-color-secondary);
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .empty-text {
            font-size: 16px;
            margin-bottom: 8px;
        }

        .empty-subtext {
            font-size: 14px;
            opacity: 0.7;
        }

        .panel {
            background: transparent;
            border-radius: 0;
            padding: 0;
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .panel-title {
            font-size: 20px;
            font-weight: 600;
            margin: 0;
        }

        .mode-switch {
            display: flex;
            background: var(--background-color);
            border-radius: var(--border-radius);
            padding: 4px;
        }

        .mode-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            color: var(--text-color-secondary);
        }

        .mode-btn.active {
            background: var(--white);
            color: var(--primary-color);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            font-size: 14px;
            color: var(--text-color);
        }

        .ant-input, .ant-select, .ant-input-number, .ant-slider {
            width: 100% !important;
        }

        .text-input {
            min-height: 400px !important;
            resize: vertical;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            line-height: 1.6;
        }

        .text-input.long-text {
            min-height: 500px !important;
            max-height: 700px;
            border-color: var(--warning-color);
            box-shadow: 0 0 0 2px rgba(250, 173, 20, 0.1);
        }

        .text-input.long-text:focus {
            border-color: var(--warning-color);
            box-shadow: 0 0 0 3px rgba(250, 173, 20, 0.2);
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }

        .preset-card {
            padding: 16px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--white);
            min-width: 280px;
        }

        .preset-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--box-shadow);
        }

        .preset-card.selected {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--white);
        }

        .preset-name {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .preset-description {
            font-size: 13px;
            opacity: 0.8;
            line-height: 1.4;
        }

        .preset-details {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-top: 10px;
            font-size: 12px;
        }

        .detail-row {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 0;
        }

        .detail-item {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .detail-label {
            opacity: 0.7;
            font-weight: 500;
            min-width: 35px;
        }

        .detail-value {
            font-weight: 600;
        }

        .detail-icon {
            font-size: 14px;
        }

        .preset-detail-panel {
            margin-top: 16px;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
        }

        .preset-detail-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(0, 0, 0, 0.1);
        }

        .preset-detail-icon {
            font-size: 24px;
        }

        .preset-detail-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-color);
        }

        .preset-detail-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .preset-detail-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: var(--white);
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .preset-detail-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .preset-detail-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .preset-detail-label {
            font-size: 12px;
            color: var(--text-color-secondary);
            font-weight: 500;
        }

        .preset-detail-value {
            font-size: 14px;
            color: var(--text-color);
            font-weight: 600;
        }

        .advanced-settings {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: var(--white);
            padding: 12px 24px;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: var(--white);
            border: 2px solid var(--border-color);
            color: var(--text-color);
            padding: 10px 20px;
            border-radius: var(--border-radius);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-right: 12px;
        }

        .btn-secondary:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .task-item {
            display: grid;
            grid-template-columns: 40px 100px 80px 1fr 80px 600px;
            gap: 12px;
            padding: 10px 16px;
            background: var(--white);
            border-bottom: 1px solid var(--border-color);
            align-items: center;
            min-height: 44px;
        }

        .task-item.selected {
            background-color: #e6f7ff;
        }

        .task-item:hover {
            background-color: #f5f5f5;
        }

        .task-item.selected:hover {
            background-color: #bae7ff;
        }

        .task-checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: var(--primary-color);
        }

        .batch-actions {
            display: flex;
            gap: 8px;
            padding: 12px 16px;
            background: #fff7e6;
            border-bottom: 1px solid var(--border-color);
            align-items: center;
        }

        .batch-actions.hidden {
            display: none;
        }

        .batch-info {
            font-size: 13px;
            color: var(--text-color);
            font-weight: 500;
        }

        .batch-btn {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--white);
            color: var(--text-color);
            cursor: pointer;
            font-size: 13px;
            transition: all 0.15s ease;
        }

        .batch-btn:hover {
            background: #f0f0f0;
            border-color: #d0d0d0;
        }

        .batch-btn.danger {
            color: #dc3545;
            border-color: #dc3545;
        }

        .batch-btn.danger:hover {
            background: #dc3545;
            color: var(--white);
        }

        .batch-btn.primary {
            color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .batch-btn.primary:hover {
            background: var(--primary-color);
            color: var(--white);
        }

        .task-item:last-child {
            border-bottom: none;
        }

        @media (max-width: 768px) {
            .task-item {
                grid-template-columns: 1fr;
                gap: 8px;
                padding: 12px;
                min-height: auto;
            }
        }

        .task-header {
            display: none;
        }

        .task-id {
            font-family: 'Courier New', monospace;
            font-size: 11px;
            color: var(--primary-color);
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-weight: 600;
            text-align: center;
        }

        .status-badge {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            text-align: center;
            display: inline-block;
        }

        .status-pending {
            background: #fff7e6;
            color: #d46b08;
            border: 1px solid #ffd591;
        }

        .status-processing {
            background: #e6f7ff;
            color: #0958d9;
            border: 1px solid #91d5ff;
        }

        .status-completed {
            background: #f6ffed;
            color: #389e0d;
            border: 1px solid #b7eb8f;
        }

        .status-failed {
            background: #fff2f0;
            color: #d32f2f;
            border: 1px solid #ffccc7;
        }

        .task-text {
            color: var(--text-color);
            font-size: 12px;
            line-height: 1.4;
            overflow: hidden;
        }

        .task-text-content {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .progress-container {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-left: 8px;
        }

        .progress-text {
            font-size: 10px;
            color: var(--primary-color);
            font-weight: 500;
            white-space: nowrap;
        }

        .progress-bar-bg {
            width: 60px;
            height: 3px;
            background: #e0e0e0;
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: var(--primary-color);
            transition: width 0.3s ease;
            border-radius: 2px;
        }

        .task-actions {
            display: flex;
            gap: 4px;
            flex-wrap: nowrap;
            justify-content: flex-end;
            align-items: center;
        }

        @media (max-width: 768px) {
            .task-actions {
                justify-content: flex-start;
            }
        }

        .mini-btn {
            padding: 2px 4px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--white);
            width: 30px;
            height: 30px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: var(--text-color);
            cursor: pointer;
            font-size: 13px;
            text-decoration: none;
            transition: all 0.15s ease;
            flex-shrink: 0;
            white-space: nowrap;
        }

        .mini-btn:hover {
            background: #f0f0f0;
            border-color: #d0d0d0;
        }

        .mini-btn:active {
            background: #e0e0e0;
            border-color: #c0c0c0;
        }

        .mini-btn.active {
            background: #dc3545;
            border-color: #dc3545;
            color: white;
        }

        .mini-btn.active:hover {
            background: #c82333;
            border-color: #c82333;
            color: white;
        }

        .mini-btn.audio {
            border-color: var(--success-color);
            color: var(--success-color);
        }

        .mini-btn.audio:hover {
            background: var(--success-color);
            color: var(--white);
        }

        .ssml-preview {
            background: #f6f8fa;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 16px;
            margin-top: 16px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .audio-player {
            width: 100%;
            margin-top: 12px;
        }

        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: var(--border-radius);
            color: var(--white);
            font-weight: 500;
            box-shadow: var(--box-shadow);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .notification.success {
            background: var(--success-color);
        }

        .notification.error {
            background: var(--error-color);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* ËØ¶ÊÉÖ‰æßËæπÊ†èÊ†∑Âºè */
        .detail-panel {
            position: fixed;
            top: 0;
            left: -50%;
            width: 50%;
            height: 100%;
            background: white;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            transition: left 0.3s ease;
            overflow-y: auto;
        }

        .detail-panel.show {
            left: 0;
        }

        .detail-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .detail-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }

        .close-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .detail-content {
            padding: 20px;
        }

        .detail-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .detail-section:last-child {
            border-bottom: none;
        }

        .detail-section h4 {
            margin: 0 0 15px 0;
            color: var(--primary-color);
            font-size: 16px;
            font-weight: 600;
        }

        .detail-item {
            display: flex;
            margin-bottom: 10px;
            align-items: flex-start;
        }

        .detail-item label {
            font-weight: 500;
            color: var(--text-color-secondary);
            min-width: 80px;
            margin-right: 10px;
        }

        .detail-item span {
            color: var(--text-color);
            flex: 1;
            word-break: break-word;
        }

        .text-content {
            background: var(--bg-color);
            padding: 12px;
            border-radius: var(--border-radius);
            line-height: 1.6;
            max-height: 150px;
            overflow-y: auto;
            font-size: 14px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary-color);
            transition: width 0.3s ease;
        }

        .audio-section {
            text-align: center;
        }

        .detail-audio {
            width: 100%;
            margin-bottom: 15px;
        }

        .audio-actions {
            margin-top: 15px;
        }

        .error-section {
            border-left: 4px solid #e74c3c;
            background: #fdf2f2;
        }

        .error-section h4 {
            color: #e74c3c;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 4px;
            font-size: 14px;
            border: 1px solid #f5c6cb;
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .sidebar {
                width: 60px;
            }

            .sidebar.collapsed {
                width: 60px;
            }

            .sidebar-header {
                display: none;
            }

            .menu-item {
                padding: 12px;
                justify-content: center;
            }

            .menu-text {
                display: none;
            }

            .menu-icon {
                font-size: 20px;
            }

            .content-area {
                padding: 16px;
            }

            .app-title {
                font-size: 18px;
            }

            .app-subtitle {
                display: none;
            }

            .detail-panel {
                width: 100%;
                left: -100%;
            }

            .detail-panel.show {
                left: 0;
            }

            .detail-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .detail-item label {
                margin-bottom: 5px;
            }

            .modal-content {
                width: 90%;
                max-width: none;
            }
        }

        /* Ê®°ÊÄÅÂØπËØùÊ°ÜÊ†∑Âºè */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .modal-content {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
            width: 400px;
            max-width: 90%;
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: var(--text-color);
        }

        .modal-body {
            padding: 24px;
        }

        .modal-body label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .modal-footer .btn-primary {
            width: auto;
        }

        .modal-footer .btn-secondary {
            margin-right: 0;
        }

        /* Âõ∫ÂÆöÈü≥È¢ëÊí≠ÊîæÂô®Ê†∑Âºè */
        .fixed-audio-player {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 9000;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .fixed-audio-player audio {
            width: 300px;
            height: 40px;
        }

        .close-audio-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: #f0f0f0;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            line-height: 1;
            color: #666;
            transition: all 0.2s ease;
        }

        .close-audio-btn:hover {
            background: #e0e0e0;
            color: #333;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="app-container">
            <!-- Â§¥ÈÉ® -->
            <div class="app-header">
                <div>
                    <h1 class="app-title">üéôÔ∏è AI Voice TTS</h1>
                    <p class="app-subtitle">Êô∫ËÉΩËØ≠Èü≥ÂêàÊàêÁ≥ªÁªü - ÊîØÊåÅ SSML È´òÁ∫ßÂäüËÉΩ</p>
                </div>
            </div>

            <!-- ‰∏ªË¶ÅÂÜÖÂÆπÔºö‰æßËæπÊ†è + ÂÜÖÂÆπÂå∫Âüü -->
            <div class="main-content">
                <!-- Â∑¶‰æßËæπÊ†èËèúÂçï -->
                <div class="sidebar" :class="{ collapsed: sidebarCollapsed }">
                    <div class="sidebar-header">
                        <button class="collapse-btn" @click="sidebarCollapsed = !sidebarCollapsed" :title="sidebarCollapsed ? 'Â±ïÂºÄËèúÂçï' : 'ÊäòÂè†ËèúÂçï'">
                            {{ sidebarCollapsed ? '‚ñ∂' : '‚óÄ' }}
                        </button>
                    </div>
                    <ul class="menu-list">
                        <li
                            class="menu-item"
                            :class="{ active: activeTab === 'create' }"
                            @click="activeTab = 'create'"
                            :title="sidebarCollapsed ? 'ÂàõÂª∫‰ªªÂä°' : ''"
                        >
                            <span class="menu-icon">üìù</span>
                            <span class="menu-text">ÂàõÂª∫‰ªªÂä°</span>
                        </li>
                        <li
                            class="menu-item"
                            :class="{ active: activeTab === 'tasks' }"
                            @click="activeTab = 'tasks'"
                            :title="sidebarCollapsed ? '‰ªªÂä°ÂàóË°®' : ''"
                        >
                            <span class="menu-icon">üìã</span>
                            <span class="menu-text">‰ªªÂä°ÂàóË°®</span>
                        </li>
                        <li
                            class="menu-item"
                            :class="{ active: activeTab === 'saved' }"
                            @click="activeTab = 'saved'"
                            :title="sidebarCollapsed ? '‰øùÂ≠òÁöÑÈü≥È¢ë' : ''"
                        >
                            <span class="menu-icon">üíæ</span>
                            <span class="menu-text">‰øùÂ≠òÁöÑÈü≥È¢ë</span>
                        </li>
                        <li
                            class="menu-item"
                            :class="{ active: activeTab === 'ai-config' }"
                            @click="activeTab = 'ai-config'"
                            :title="sidebarCollapsed ? 'AIÈÖçÁΩÆ' : ''"
                        >
                            <span class="menu-icon">ü§ñ</span>
                            <span class="menu-text">AIÈÖçÁΩÆ</span>
                        </li>
                    </ul>
                </div>

                <!-- Âè≥‰æßÂÜÖÂÆπÂå∫Âüü -->
                <div class="content-area">
                    <!-- ÂàõÂª∫‰ªªÂä°È°µÈù¢ -->
                    <div v-show="activeTab === 'create'" class="content-panel">
                        <div class="panel">
                            <div class="panel-header">
                                <h2 class="panel-title">üìù ÂàõÂª∫ËØ≠Èü≥‰ªªÂä°</h2>
                                        <div class="mode-switch">
                                            <button
                                                class="mode-btn"
                                                :class="{active: mode === 'ssml'}"
                                                @click="mode = 'ssml'"
                                            >
                                                SSML È´òÁ∫ß
                                            </button>
                                            <button
                                                class="mode-btn"
                                                :class="{active: mode === 'basic'}"
                                                @click="mode = 'basic'"
                                            >
                                                Âü∫Á°ÄÊ®°Âºè
                                            </button>
                                        </div>
                                    </div>

                                    <!-- SSML Ê®°Âºè -->
                                    <div v-if="mode === 'ssml'">
                                        <!-- È¢ÑËÆæÈÄâÊã© -->
                                        <div class="form-group">
                                            <label class="form-label">üéØ ÈÄâÊã©ËØ≠Èü≥È£éÊ†ºÈ¢ÑËÆæ</label>
                                            <select
                                                v-model="selectedPreset"
                                                @change="onPresetChange"
                                                class="ant-input">
                                                <option v-for="preset in ssmlPresets"
                                                        :key="preset.name"
                                                        :value="preset.name">
                                                    {{ preset.description }}
                                                </option>
                                            </select>

                                            <!-- È¢ÑËÆæËØ¶ÊÉÖ -->
                                            <div v-if="selectedPreset && ssmlPresets[selectedPreset]" class="preset-detail-panel">
                                                <div class="preset-detail-header">
                                                    <span class="preset-detail-icon">üéôÔ∏è</span>
                                                    <span class="preset-detail-title">{{ ssmlPresets[selectedPreset].description }}</span>
                                                </div>
                                                <div class="preset-detail-grid">
                                                    <div class="preset-detail-item">
                                                        <span class="preset-detail-icon">üó£Ô∏è</span>
                                                        <div class="preset-detail-content">
                                                            <div class="preset-detail-label">ËØ≠Èü≥</div>
                                                            <div class="preset-detail-value">{{ ssmlPresets[selectedPreset].voice }}</div>
                                                        </div>
                                                    </div>
                                                    <div class="preset-detail-item">
                                                        <span class="preset-detail-icon">‚ö°</span>
                                                        <div class="preset-detail-content">
                                                            <div class="preset-detail-label">ËØ≠ÈÄü</div>
                                                            <div class="preset-detail-value">{{ ssmlPresets[selectedPreset].rate }}</div>
                                                        </div>
                                                    </div>
                                                    <div class="preset-detail-item">
                                                        <span class="preset-detail-icon">üéµ</span>
                                                        <div class="preset-detail-content">
                                                            <div class="preset-detail-label">Èü≥Ë∞É</div>
                                                            <div class="preset-detail-value">{{ ssmlPresets[selectedPreset].pitch }}</div>
                                                        </div>
                                                    </div>
                                                    <div class="preset-detail-item">
                                                        <span class="preset-detail-icon">‚è∏Ô∏è</span>
                                                        <div class="preset-detail-content">
                                                            <div class="preset-detail-label">ÈÄóÂè∑ÂÅúÈ°ø</div>
                                                            <div class="preset-detail-value">{{ ssmlPresets[selectedPreset].comma_pause }}</div>
                                                        </div>
                                                    </div>
                                                    <div class="preset-detail-item">
                                                        <span class="preset-detail-icon">üí≠</span>
                                                        <div class="preset-detail-content">
                                                            <div class="preset-detail-label">Âè•Â≠êÂÅúÈ°ø</div>
                                                            <div class="preset-detail-value">{{ ssmlPresets[selectedPreset].sentence_pause }}</div>
                                                        </div>
                                                    </div>
                                                    <div class="preset-detail-item">
                                                        <span class="preset-detail-icon">üìñ</span>
                                                        <div class="preset-detail-content">
                                                            <div class="preset-detail-label">ÊÆµËêΩÂÅúÈ°ø</div>
                                                            <div class="preset-detail-value">{{ ssmlPresets[selectedPreset].paragraph_pause || '1200ms' }}</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- È´òÁ∫ßËÆæÁΩÆ -->
                                        <div class="advanced-settings">
                                            <div class="form-group">
                                                <label class="form-label">‚öôÔ∏è È´òÁ∫ßËÆæÁΩÆÔºàË¶ÜÁõñÈ¢ÑËÆæÔºâ</label>
                                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                                    <div>
                                                        <label class="form-label" style="font-size: 12px; color: var(--text-color-secondary);">ËØ≠Èü≥Ê®°Âûã</label>
                                                        <select v-model="ssmlConfig.voice" class="ant-select">
                                                            <option value="zh-CN-XiaoxiaoNeural">ÊôìÊôì Neural</option>
                                                            <option value="zh-CN-YunxiNeural">‰∫ëÂ∏å Neural</option>
                                                            <option value="zh-CN-YunyangNeural">‰∫ëÊâ¨ Neural</option>
                                                        </select>
                                                    </div>
                                                    <div>
                                                        <label class="form-label" style="font-size: 12px; color: var(--text-color-secondary);">ËØ≠Èü≥È£éÊ†º</label>
                                                        <select v-model="ssmlConfig.style" class="ant-select">
                                                            <option value="">ÈªòËÆ§</option>
                                                            <option value="calm">Âπ≥Èùô</option>
                                                            <option value="gentle">Ê∏©Êüî</option>
                                                            <option value="cheerful">Ê¥ªÊ≥º</option>
                                                            <option value="narrator">ËÆ≤Ëø∞ËÄÖ</option>
                                                        </select>
                                                    </div>
                                                    <div>
                                                        <label class="form-label" style="font-size: 12px; color: var(--text-color-secondary);">ËØ≠ÈÄü (Ë¥üÊï∞=ÊÖ¢ÈÄü)</label>
                                                        <input v-model="ssmlConfig.rate" type="text" class="ant-input" placeholder="‰æãÂ¶Ç: -15%">
                                                    </div>
                                                    <div>
                                                        <label class="form-label" style="font-size: 12px; color: var(--text-color-secondary);">Èü≥Ë∞É (Ê≠£Êï∞=È´òÈü≥Ë∞É)</label>
                                                        <input v-model="ssmlConfig.pitch" type="text" class="ant-input" placeholder="‰æãÂ¶Ç: +1%">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ÊñáÊú¨ËæìÂÖ• -->
                                        <div class="form-group">
                                            <label class="form-label">üìñ ËæìÂÖ•ÊñáÊú¨ÂÜÖÂÆπ</label>

                                            <!-- Êñá‰ª∂‰∏ä‰º†ÂíåÂ∑•ÂÖ∑ÊåâÈíÆ -->
                                            <div style="display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
                                                <input
                                                    type="file"
                                                    ref="fileInput"
                                                    @change="handleFileUpload"
                                                    accept=".txt,.md"
                                                    style="display: none;"
                                                >
                                                <button class="btn-secondary" @click="$refs.fileInput.click()" style="font-size: 12px; padding: 4px 12px;">
                                                    üìÅ ‰∏ä‰º†ÊñáÊú¨Êñá‰ª∂
                                                </button>
                                                <button
                                                    class="btn-secondary"
                                                    @click="text = ''"
                                                    style="font-size: 12px; padding: 4px 12px;"
                                                    v-if="text"
                                                >
                                                    üóëÔ∏è Ê∏ÖÁ©∫ÊñáÊú¨
                                                </button>
                                                <div style="margin-left: auto; font-size: 12px; color: var(--text-color-secondary); display: flex; align-items: center; gap: 10px;">
                                                    <span :style="{ color: text.length > 50000 ? 'var(--error-color)' : 'inherit' }">
                                                        Â≠óÁ¨¶Êï∞: {{ text.length.toLocaleString() }}
                                                    </span>
                                                    <span v-if="text.length > 50000" style="color: var(--warning-color);">
                                                        ‚ö†Ô∏è ÈïøÊñáÊú¨Â§ÑÁêÜ‰∏≠
                                                    </span>
                                                </div>
                                            </div>

                                            <textarea
                                                    v-model="text"
                                                    class="ant-input text-input"
                                                    :class="{ 'long-text': text.length > 50000 }"
                                                    placeholder="ËØ∑ËæìÂÖ•Ë¶ÅËΩ¨Êç¢‰∏∫ËØ≠Èü≥ÁöÑÊñáÊú¨ÂÜÖÂÆπ...&#10;&#10;‚úÖ ÊîØÊåÅË∂ÖÈïøÊñáÊú¨ÔºàÂª∫ËÆÆ5‰∏áÂ≠ó‰ª•ÂÜÖÔºâ&#10;‚úÖ Á≥ªÁªü‰ºöËá™Âä®ÂàÜÊÆµÂ§ÑÁêÜ&#10;‚úÖ ÊîØÊåÅ .txt Âíå .md Êñá‰ª∂‰∏ä‰º†">
                                            </textarea>

                                            <!-- ÊñáÊú¨ÁªüËÆ°ÂíåÁä∂ÊÄÅ -->
                                            <div style="margin-top: 8px; font-size: 12px; display: flex; justify-content: space-between; align-items: center;">
                                                <div style="color: var(--text-color-secondary);">
                                                    <span v-if="text.length === 0">ËØ∑ËæìÂÖ•ÊñáÊú¨Êàñ‰∏ä‰º†Êñá‰ª∂</span>
                                                    <span v-else-if="text.length < 1000">Áü≠ÊñáÊú¨ ({{
                                                        Math.ceil(text.length / 200) }}‰∏™Èü≥È¢ëÁâáÊÆµ)</span>
                                                    <span v-else-if="text.length < 10000">‰∏≠Á≠âÊñáÊú¨ ({{
                                                        Math.ceil(text.length / 1000) }}‰∏™Èü≥È¢ëÁâáÊÆµ)</span>
                                                    <span v-else-if="text.length < 50000">ÈïøÊñáÊú¨ ({{
                                                        Math.ceil(text.length / 1000) }}‰∏™Èü≥È¢ëÁâáÊÆµ)</span>
                                                    <span v-else style="color: var(--warning-color); font-weight: bold;">
                                                        Ë∂ÖÈïøÊñáÊú¨ ({{ Math.ceil(text.length / 1000) }}‰∏™Èü≥È¢ëÁâáÊÆµ)
                                                    </span>
                                                </div>
                                                <div style="display: flex; gap: 10px; align-items: center;">
                                                    <span v-if="text.length > 50000" style="color: var(--info-color);">
                                                        üí° Âª∫ËÆÆ‰ΩøÁî®ÂàÜÊÆµÊ®°Âºè
                                                    </span>
                                                    <span v-if="text.length > 100000" style="color: var(--error-color); font-weight: bold;">
                                                        ‚ö†Ô∏è Â§ÑÁêÜÊó∂Èó¥ËæÉÈïø
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- AIÂØπËØùÂàÜÊûê -->
                                        <div class="form-group" v-if="text && text.length > 100">
                                            <div style="border: 1px solid #d9d9d9; border-radius: 6px; padding: 16px; background: #fafafa;">
                                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                                    <div style="font-weight: 600; font-size: 14px;">
                                                        ü§ñ AIÂØπËØùÂàÜÊûêÔºàÂ§öËßíËâ≤ÈÖçÈü≥Ôºâ
                                                    </div>
                                                    <button
                                                        v-if="!analysisResult"
                                                        class="btn-secondary"
                                                        @click="analyzeText"
                                                        :disabled="analyzing || !hasAIConfig"
                                                        style="font-size: 13px; padding: 6px 12px;"
                                                    >
                                                        {{ analyzing ? 'ÂàÜÊûê‰∏≠...' : 'üîç ÂºÄÂßãÂàÜÊûê' }}
                                                    </button>
                                                    <button
                                                        v-else
                                                        class="btn-secondary"
                                                        @click="analysisResult = null"
                                                        style="font-size: 13px; padding: 6px 12px;"
                                                    >
                                                        üîÑ ÈáçÊñ∞ÂàÜÊûê
                                                    </button>
                                                </div>

                                                <div v-if="!hasAIConfig" style="color: #ff4d4f; font-size: 12px; margin-bottom: 8px;">
                                                    ‚ö†Ô∏è ËØ∑ÂÖàÂú®"AIÈÖçÁΩÆ"È°µÈù¢Ê∑ªÂä†AIÊúçÂä°ÈÖçÁΩÆ
                                                </div>

                                                <!-- ÂàÜÊûêËøõÂ∫¶ -->
                                                <div v-if="analyzing" style="background: #e6f7ff; border: 1px solid #91d5ff; border-radius: 4px; padding: 12px; margin-bottom: 12px;">
                                                    <div style="display: flex; align-items: center; gap: 8px;">
                                                        <span class="loading-spinner" style="width: 16px; height: 16px;"></span>
                                                        <span style="color: #1890ff; font-size: 13px;">{{ analysisProgress }}</span>
                                                    </div>
                                                </div>

                                                <!-- ÂàÜÊûêÁªìÊûú -->
                                                <div v-if="analysisResult && analysisResult.status === 'completed'" style="background: #fff; border: 1px solid #d9d9d9; border-radius: 4px; padding: 12px;">
                                                    <!-- ËßíËâ≤ÂàóË°® -->
                                                    <div style="margin-bottom: 16px;">
                                                        <div style="font-weight: 600; font-size: 13px; margin-bottom: 8px;">üìñ Ê£ÄÊµãÂà∞ÁöÑËßíËâ≤ ({{ Object.keys(analysisResult.characters || {}).length }}‰∏™)</div>
                                                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                                            <div
                                                                v-for="(char, name) in analysisResult.characters"
                                                                :key="name"
                                                                style="background: #f0f0f0; border-radius: 4px; padding: 6px 10px; font-size: 12px; display: flex; align-items: center; gap: 6px;"
                                                            >
                                                                <span>{{ name }}</span>
                                                                <span style="color: #8c8c8c;">({{ char.dialog_count }}Âè•)</span>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- ‰∏∫ËßíËâ≤ÂàÜÈÖçÂ£∞Èü≥ -->
                                                    <div style="margin-bottom: 16px;">
                                                        <div style="font-weight: 600; font-size: 13px; margin-bottom: 8px;">üéôÔ∏è ‰∏∫ËßíËâ≤ÂàÜÈÖçÂ£∞Èü≥ÔºàÂ∑≤Ëá™Âä®ÂàÜÈÖçÔºâ</div>
                                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                                                            <div
                                                                v-for="(char, name) in analysisResult.characters"
                                                                :key="name"
                                                                style="display: flex; align-items: center; gap: 8px; padding: 8px; background: #f9f9f9; border-radius: 4px; border-left: 3px solid #1890ff;"
                                                            >
                                                                <span style="font-size: 12px; min-width: 60px;">{{ name }}</span>
                                                                <span style="font-size: 11px; color: #666; background: #e6f7ff; padding: 2px 6px; border-radius: 3px;">
                                                                    {{ detectGender(name) === 'male' ? 'üë® Áî∑' : 'üë© Â•≥' }}
                                                                </span>
                                                                <select
                                                                    v-model="characterVoices[name]"
                                                                    class="ant-input"
                                                                    style="flex: 1; font-size: 12px; padding: 4px 8px;"
                                                                >
                                                                    <option value="">ÈÄâÊã©Â£∞Èü≥</option>
                                                                    <option v-for="voice in availableVoices" :key="voice" :value="voice">{{ voice }}</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div style="font-size: 11px; color: #999; margin-top: 6px;">
                                                            üí° ÊóÅÁôΩÂ∞Ü‰ΩøÁî®: {{ ssmlConfig.voice || 'zh-CN-XiaoxiaoNeural' }}
                                                        </div>
                                                    </div>

                                                    <!-- ÁâáÊÆµÁªüËÆ° -->
                                                    <div style="font-size: 12px; color: #8c8c8c; padding-top: 8px; border-top: 1px solid #f0f0f0;">
                                                        <div>ËØÜÂà´Âà∞ {{ analysisResult.segments?.filter(s => s.type === 'dialog').length || 0 }} Âè•ÂØπËØù</div>
                                                        <div>ËØÜÂà´Âà∞ {{ analysisResult.segments?.filter(s => s.type === 'narration').length || 0 }} ÊÆµÊóÅÁôΩ</div>
                                                        <div v-if="analysisResult.analysis_metadata">
                                                            Â§ÑÁêÜÊó∂Èó¥: {{ (analysisResult.analysis_metadata.processing_time || 0).toFixed(2) }}Áßí
                                                        </div>
                                                    </div>

                                                    <!-- ÁîüÊàêÊåâÈíÆ -->
                                                    <button
                                                        class="btn-primary"
                                                        @click="createMultiVoiceTask"
                                                        :disabled="!allCharactersAssigned || creating"
                                                        style="margin-top: 12px; width: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"
                                                    >
                                                        {{ creating ? 'ÁîüÊàê‰∏≠...' : 'üöÄ ÁîüÊàêÂ§öËßíËâ≤ËØ≠Èü≥' }}
                                                    </button>
                                                    <div v-if="!allCharactersAssigned" style="color: #ff4d4f; font-size: 12px; margin-top: 8px; text-align: center;">
                                                        ‚ö†Ô∏è ËØ∑‰∏∫ÊâÄÊúâËßíËâ≤ÂàÜÈÖçÂ£∞Èü≥
                                                    </div>
                                                </div>

                                                <!-- ÂàÜÊûêÂ§±Ë¥• -->
                                                <div v-if="analysisResult && analysisResult.status === 'failed'" style="background: #fff2f0; border: 1px solid #ffccc7; border-radius: 4px; padding: 12px;">
                                                    <div style="color: #ff4d4f; font-size: 13px;">
                                                        ‚ùå ÂàÜÊûêÂ§±Ë¥•: {{ analysisResult.error || 'Êú™Áü•ÈîôËØØ' }}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- SSML È¢ÑËßà -->
                                        <div class="form-group" v-if="text && selectedPreset && !analysisResult">
                                            <button class="btn-secondary" @click="previewSSML">
                                                üëÅÔ∏è È¢ÑËßà SSML
                                            </button>
                                            <div class="ssml-preview" v-if="ssmlPreview">
                                                {{ ssmlPreview }}
                                            </div>
                                        </div>

                                        <!-- ÂàõÂª∫ÊåâÈíÆ -->
                                        <button
                                                class="btn-primary"
                                                @click="createSSMLTask"
                                                :disabled="!text || creating"
                                                :style="{
                                                    backgroundColor: text.length > 50000 ? 'var(--warning-color)' : '',
                                                    borderColor: text.length > 50000 ? 'var(--warning-color)' : ''
                                                }"
                                        >
                                            <span v-if="creating">
                                                <span class="loading-spinner"></span>
                                                <span v-if="text.length > 100000">
                                                    Ê≠£Âú®Â§ÑÁêÜË∂ÖÈïøÊñáÊú¨... (È¢ÑËÆ°ÈúÄË¶ÅËæÉÈïøÊó∂Èó¥)
                                                </span>
                                                <span v-else-if="text.length > 50000">
                                                    Ê≠£Âú®Â§ÑÁêÜÈïøÊñáÊú¨...
                                                </span>
                                                <span v-else>
                                                    Ê≠£Âú®ÂàõÂª∫‰ªªÂä°...
                                                </span>
                                            </span>
                                            <span v-else>
                                                <span v-if="text.length > 100000">
                                                    üöÄ ÂºÄÂßãÂêàÊàêË∂ÖÈïøÊñáÊú¨ ({{ Math.ceil(text.length / 1000) }}ÁâáÊÆµ)
                                                </span>
                                                <span v-else-if="text.length > 50000">
                                                    üöÄ ÂºÄÂßãÂêàÊàêÈïøÊñáÊú¨ ({{ Math.ceil(text.length / 1000) }}ÁâáÊÆµ)
                                                </span>
                                                <span v-else>
                                                    üöÄ ÂºÄÂßãËØ≠Èü≥ÂêàÊàê
                                                </span>
                                            </span>
                                        </button>
                                    </div>

                                    <!-- Âü∫Á°ÄÊ®°Âºè -->
                                    <div v-else>
                                        <!-- ËØ≠Èü≥ÈÄâÊã© -->
                                        <div class="form-group">
                                            <label class="form-label">üé§ ÈÄâÊã©ËØ≠Èü≥Ê®°Âûã</label>
                                            <select v-model="basicConfig.voice" class="ant-select">
                                                <option value="zh-CN-XiaoxiaoNeural">ÊôìÊôì Neural (Â•≥Â£∞)</option>
                                                <option value="zh-CN-YunxiNeural">‰∫ëÂ∏å Neural (Áî∑Â£∞)</option>
                                                <option value="zh-CN-YunyangNeural">‰∫ëÊâ¨ Neural (Áî∑Â£∞)</option>
                                            </select>
                                        </div>

                                        <!-- ËØ≠ÈÄüÂíåÈü≥Ë∞É -->
                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                            <div class="form-group">
                                                <label class="form-label">‚ö° ËØ≠ÈÄü</label>
                                                <input v-model="basicConfig.rate" type="text" class="ant-input" placeholder="‰æãÂ¶Ç: -15%">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">üéµ Èü≥Ë∞É</label>
                                                <input v-model="basicConfig.pitch" type="text" class="ant-input" placeholder="‰æãÂ¶Ç: -2Hz">
                                            </div>
                                        </div>

                                        <!-- ÊñáÊú¨ËæìÂÖ• -->
                                        <div class="form-group">
                                            <label class="form-label">üìñ ËæìÂÖ•ÊñáÊú¨ÂÜÖÂÆπ</label>

                                            <!-- Êñá‰ª∂‰∏ä‰º†ÂíåÂ∑•ÂÖ∑ÊåâÈíÆ -->
                                            <div style="display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
                                                <input
                                                    type="file"
                                                    ref="fileInputBasic"
                                                    @change="handleFileUpload"
                                                    accept=".txt,.md"
                                                    style="display: none;"
                                                >
                                                <button class="btn-secondary" @click="$refs.fileInputBasic.click()" style="font-size: 12px; padding: 4px 12px;">
                                                    üìÅ ‰∏ä‰º†ÊñáÊú¨Êñá‰ª∂
                                                </button>
                                                <button
                                                    class="btn-secondary"
                                                    @click="text = ''"
                                                    style="font-size: 12px; padding: 4px 12px;"
                                                    v-if="text"
                                                >
                                                    üóëÔ∏è Ê∏ÖÁ©∫ÊñáÊú¨
                                                </button>
                                                <div style="margin-left: auto; font-size: 12px; color: var(--text-color-secondary); display: flex; align-items: center; gap: 10px;">
                                                    <span :style="{ color: text.length > 50000 ? 'var(--error-color)' : 'inherit' }">
                                                        Â≠óÁ¨¶Êï∞: {{ text.length.toLocaleString() }}
                                                    </span>
                                                    <span v-if="text.length > 50000" style="color: var(--warning-color);">
                                                        ‚ö†Ô∏è ÈïøÊñáÊú¨Â§ÑÁêÜ‰∏≠
                                                    </span>
                                                </div>
                                            </div>

                                            <textarea
                                                    v-model="text"
                                                    class="ant-input text-input"
                                                    :class="{ 'long-text': text.length > 50000 }"
                                                    placeholder="ËØ∑ËæìÂÖ•Ë¶ÅËΩ¨Êç¢‰∏∫ËØ≠Èü≥ÁöÑÊñáÊú¨ÂÜÖÂÆπ...&#10;&#10;‚úÖ ÊîØÊåÅË∂ÖÈïøÊñáÊú¨ÔºàÂª∫ËÆÆ5‰∏áÂ≠ó‰ª•ÂÜÖÔºâ&#10;‚úÖ Á≥ªÁªü‰ºöËá™Âä®ÂàÜÊÆµÂ§ÑÁêÜ&#10;‚úÖ ÊîØÊåÅ .txt Âíå .md Êñá‰ª∂‰∏ä‰º†">
                                            </textarea>

                                            <!-- ÊñáÊú¨ÁªüËÆ°ÂíåÁä∂ÊÄÅ -->
                                            <div style="margin-top: 8px; font-size: 12px; display: flex; justify-content: space-between; align-items: center;">
                                                <div style="color: var(--text-color-secondary);">
                                                    <span v-if="text.length === 0">ËØ∑ËæìÂÖ•ÊñáÊú¨Êàñ‰∏ä‰º†Êñá‰ª∂</span>
                                                    <span v-else-if="text.length < 1000">Áü≠ÊñáÊú¨ ({{
                                                        Math.ceil(text.length / 200) }}‰∏™Èü≥È¢ëÁâáÊÆµ)</span>
                                                    <span v-else-if="text.length < 10000">‰∏≠Á≠âÊñáÊú¨ ({{
                                                        Math.ceil(text.length / 1000) }}‰∏™Èü≥È¢ëÁâáÊÆµ)</span>
                                                    <span v-else-if="text.length < 50000">ÈïøÊñáÊú¨ ({{
                                                        Math.ceil(text.length / 1000) }}‰∏™Èü≥È¢ëÁâáÊÆµ)</span>
                                                    <span v-else style="color: var(--warning-color); font-weight: bold;">
                                                        Ë∂ÖÈïøÊñáÊú¨ ({{ Math.ceil(text.length / 1000) }}‰∏™Èü≥È¢ëÁâáÊÆµ)
                                                    </span>
                                                </div>
                                                <div style="display: flex; gap: 10px; align-items: center;">
                                                    <span v-if="text.length > 50000" style="color: var(--info-color);">
                                                        üí° Âª∫ËÆÆ‰ΩøÁî®ÂàÜÊÆµÊ®°Âºè
                                                    </span>
                                                    <span v-if="text.length > 100000" style="color: var(--error-color); font-weight: bold;">
                                                        ‚ö†Ô∏è Â§ÑÁêÜÊó∂Èó¥ËæÉÈïø
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ÂàõÂª∫ÊåâÈíÆ -->
                                        <button
                                                class="btn-primary"
                                                @click="createBasicTask"
                                                :disabled="!text || creating"
                                                :style="{
                                                    backgroundColor: text.length > 50000 ? 'var(--warning-color)' : '',
                                                    borderColor: text.length > 50000 ? 'var(--warning-color)' : ''
                                                }"
                                        >
                                            <span v-if="creating">
                                                <span class="loading-spinner"></span>
                                                <span v-if="text.length > 100000">
                                                    Ê≠£Âú®Â§ÑÁêÜË∂ÖÈïøÊñáÊú¨... (È¢ÑËÆ°ÈúÄË¶ÅËæÉÈïøÊó∂Èó¥)
                                                </span>
                                                <span v-else-if="text.length > 50000">
                                                    Ê≠£Âú®Â§ÑÁêÜÈïøÊñáÊú¨...
                                                </span>
                                                <span v-else>
                                                    Ê≠£Âú®ÂàõÂª∫‰ªªÂä°...
                                                </span>
                                            </span>
                                            <span v-else>
                                                <span v-if="text.length > 100000">
                                                    üöÄ ÂºÄÂßãÂêàÊàêË∂ÖÈïøÊñáÊú¨ ({{ Math.ceil(text.length / 1000) }}ÁâáÊÆµ)
                                                </span>
                                                <span v-else-if="text.length > 50000">
                                                    üöÄ ÂºÄÂßãÂêàÊàêÈïøÊñáÊú¨ ({{ Math.ceil(text.length / 1000) }}ÁâáÊÆµ)
                                                </span>
                                                <span v-else>
                                                    üöÄ ÂºÄÂßãËØ≠Èü≥ÂêàÊàê
                                                </span>
                                            </span>
                                        </button>
                                    </div>
                                </div>
                    </div>

                <!-- ‰ªªÂä°ÂàóË°®È°µÈù¢ -->
                <div v-show="activeTab === 'tasks'" class="content-panel">
                        <div class="panel-header">
                            <h2 class="panel-title">üìã ‰ªªÂä°ÂàóË°®</h2>
                                    <button class="btn-secondary" @click="refreshTasks">
                                        üîÑ Âà∑Êñ∞
                                    </button>
                                </div>

                                <div v-if="tasks.length === 0" class="empty-state">
                                    <div class="empty-icon">üì≠</div>
                                    <div class="empty-text">ÊöÇÊó†‰ªªÂä°</div>
                                    <div class="empty-subtext">ÂàõÂª∫ÊÇ®ÁöÑÁ¨¨‰∏Ä‰∏™ËØ≠Èü≥ÂêàÊàê‰ªªÂä°ÂêßÔºÅ</div>
                                </div>

                                <div v-else>
                                    <!-- ÊâπÈáèÊìç‰ΩúÊ†è -->
                                    <div class="batch-actions" :class="{ hidden: selectedTasks.length === 0 }">
                                        <span class="batch-info">Â∑≤ÈÄâÊã© {{ selectedTasks.length }} ‰∏™‰ªªÂä°</span>
                                        <button class="batch-btn danger" @click="batchDelete">
                                            üóëÔ∏è ÊâπÈáèÂà†Èô§
                                        </button>
                                        <button class="batch-btn" @click="clearSelection">
                                            ‚úñÔ∏è ÂèñÊ∂àÈÄâÊã©
                                        </button>
                                    </div>

                                    <div class="task-list-container">
                                        <!-- Ë°®Â§¥ -->
                                        <div class="task-list-header">
                                            <div>
                                                <input
                                                    type="checkbox"
                                                    class="task-checkbox"
                                                    :checked="isAllSelected"
                                                    @change="toggleSelectAll"
                                                    :indeterminate="selectedTasks.length > 0 && !isAllSelected"
                                                >
                                            </div>
                                            <div>‰ªªÂä°ID</div>
                                            <div>Áä∂ÊÄÅ</div>
                                            <div>ÊñáÊú¨ÂÜÖÂÆπ</div>
                                            <div style="text-align: right;">Â≠óÊï∞</div>
                                            <div style="text-align: right;">Êìç‰Ωú</div>
                                        </div>

                                        <!-- ‰ªªÂä°ÂàóË°® -->
                                        <div v-for="task in tasks" :key="task.task_id" class="task-item" :class="{ selected: selectedTasks.includes(task.task_id) }">
                                            <div>
                                                <input
                                                        type="checkbox"
                                                        class="task-checkbox"
                                                        :checked="selectedTasks.includes(task.task_id)"
                                                        @change="toggleTaskSelection(task.task_id)"
                                                    >
                                            </div>
                                            <div class="task-id">{{ task.task_id.substring(0, 8) }}</div>
                                            <div :class="['status-badge', `status-${task.status.toLowerCase()}`]">
                                                {{ getStatusText(task.status) }}
                                            </div>
                                        <div class="task-text">
                                            <span class="task-text-content">{{ task.text }}</span>
                                            <span v-if="task.progress && task.status === 'processing'" class="progress-container">
                                                <span class="progress-text">{{ Math.round(task.progress * 100) }}%</span>
                                                <span class="progress-bar-bg">
                                                    <span class="progress-bar-fill" :style="{width: task.progress * 100 + '%'}"></span>
                                                </span>
                                            </span>
                                        </div>
                                        <div style="text-align: right; color: var(--text-color-secondary); font-size: 13px;">
                                            {{ task.text ? task.text.length : 0 }}
                                        </div>
                                        <div class="task-actions">
                                            <button class="mini-btn"
                                                    :class="{ 'active': showDetailPanel && currentTaskDetail && currentTaskDetail.task_id === task.task_id }"
                                                    @click="viewTaskDetail(task.task_id)"
                                                    title="ËØ¶ÊÉÖ">
                                                üìÑ
                                            </button>
                                            <button v-if="task.text" class="mini-btn" @click="previewText(task.text, task.task_id)" title="È¢ÑËßàÂéüÊñá" style="color: var(--primary-color);">
                                                üëÅÔ∏è
                                            </button>
                                            <button v-if="task.text" class="mini-btn" @click="downloadText(task.text, task.task_id)" title="‰∏ãËΩΩÂéüÊñá" style="color: var(--success-color);">
                                                üìÑ
                                            </button>
                                            <button class="mini-btn" @click="refreshTask(task.task_id)" title="Âà∑Êñ∞">
                                                üîÑ
                                            </button>
                                            <button v-if="task.audio_url" class="mini-btn audio" @click="playAudio(task.audio_url)" title="Êí≠Êîæ">
                                                ‚ñ∂Ô∏è
                                            </button>
                                            <button v-if="task.audio_url" class="mini-btn" @click="downloadAudio(task.audio_url, task.task_id)" title="‰∏ãËΩΩÈü≥È¢ë">
                                                ‚¨áÔ∏è
                                            </button>
                                            <button v-if="task.audio_url && task.status === 'completed'" class="mini-btn" @click="showSaveDialog(task.task_id)" style="color: var(--primary-color); border-color: var(--primary-color);" title="‰øùÂ≠òÂà∞Êî∂Ëóè">
                                                üíæ
                                            </button>
                                            <button v-if="task.status === 'pending' || task.status === 'processing'" class="mini-btn" @click="cancelTask(task.task_id)" title="ÂèñÊ∂à‰ªªÂä°">
                                                ‚ùå
                                            </button>
                                            <button class="mini-btn" @click="deleteTask(task.task_id)" title="Âà†Èô§‰ªªÂä°" style="color: #dc3545; border-color: #dc3545;">
                                                üóëÔ∏è
                                            </button>
                                        </div>
                                    </div>
                                </div>
                    </div>
                </div>

                <!-- ‰øùÂ≠òÁöÑÈü≥È¢ëÈ°µÈù¢ -->
                <div v-show="activeTab === 'saved'" class="content-panel">
                        <div class="panel-header">
                            <h2 class="panel-title">üíæ ‰øùÂ≠òÁöÑÈü≥È¢ë</h2>
                            <button class="btn-secondary" @click="loadSavedAudios">
                                üîÑ Âà∑Êñ∞
                            </button>
                        </div>

                        <div v-if="savedAudios.length === 0" class="empty-state">
                            <div class="empty-icon">üéµ</div>
                            <div class="empty-text">ÊöÇÊó†‰øùÂ≠òÁöÑÈü≥È¢ë</div>
                            <div class="empty-subtext">ÂÆåÊàê‰ªªÂä°ÂêéÁÇπÂáª"‰øùÂ≠ò"ÊåâÈíÆÂç≥ÂèØ‰øùÂ≠òÈü≥È¢ë</div>
                        </div>

                        <div v-else class="saved-audio-list">
                            <div v-for="audio in savedAudios" :key="audio.id" class="saved-audio-card">
                                <div class="audio-card-header">
                                    <div class="audio-card-title" :title="audio.name">{{ audio.name }}</div>
                                </div>
                                <div class="audio-card-meta">
                                    <div>‰øùÂ≠òÊó∂Èó¥: {{ formatDateTime(audio.created_at) }}</div>
                                    <div v-if="audio.text">Â≠óÊï∞: {{ audio.text.length.toLocaleString() }}</div>
                                    <div v-if="audio.duration_seconds">Êó∂Èïø: {{ audio.duration_seconds }} Áßí</div>
                                    <div v-if="audio.file_size_bytes">Â§ßÂ∞è: {{ formatFileSize(audio.file_size_bytes) }}</div>
                                </div>
                                <audio :src="getFullAudioUrl(audio.audio_url)" controls class="audio-card-player"></audio>
                                <div class="audio-card-actions">
                                    <button v-if="audio.text" class="mini-btn" @click="previewText(audio.text, audio.name)" title="È¢ÑËßàÂéüÊñá" style="color: var(--primary-color);">
                                        üëÅÔ∏è
                                    </button>
                                    <button v-if="audio.text" class="mini-btn" @click="downloadText(audio.text, audio.name)" title="‰∏ãËΩΩÂéüÊñá" style="color: var(--success-color);">
                                        üìÑ
                                    </button>
                                    <button class="mini-btn" @click="playAudio(audio.audio_url)" title="Êí≠Êîæ">
                                        ‚ñ∂Ô∏è
                                    </button>
                                    <button class="mini-btn" @click="downloadAudio(audio.audio_url, audio.name)" title="‰∏ãËΩΩÈü≥È¢ë">
                                        ‚¨áÔ∏è
                                    </button>
                                    <button class="mini-btn" @click="deleteSavedAudio(audio.id)" style="color: #dc3545; border-color: #dc3545;" title="Âà†Èô§">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AIÈÖçÁΩÆÈ°µÈù¢ -->
                <div v-show="activeTab === 'ai-config'" class="content-panel">
                    <div class="panel">
                        <div class="panel-header">
                            <h2 class="panel-title">ü§ñ AIÂØπËØùÂàÜÊûêÈÖçÁΩÆ</h2>
                            <button class="btn-secondary" @click="loadAIConfigs">
                                üîÑ Âà∑Êñ∞
                            </button>
                        </div>

                        <div class="panel-body">
                            <!-- ÈöêÁßÅË≠¶Âëä -->
                            <div style="background: #fff7e6; border: 1px solid #ffd591; border-radius: 6px; padding: 16px; margin-bottom: 24px;">
                                <div style="display: flex; align-items: start; gap: 12px;">
                                    <span style="font-size: 24px;">‚ö†Ô∏è</span>
                                    <div>
                                        <div style="font-weight: 600; color: #d46b08; margin-bottom: 8px;">ÈöêÁßÅÊèêÁ§∫</div>
                                        <div style="color: #d46b08; font-size: 14px; line-height: 1.6;">
                                            AIÂØπËØùÂàÜÊûêÂäüËÉΩÈúÄË¶ÅÂ∞ÜÊÇ®ÁöÑÊñáÊú¨ÂèëÈÄÅÂà∞Á¨¨‰∏âÊñπAIÊúçÂä°ÂïÜÔºàGLM„ÄÅKimi„ÄÅDeepSeekÔºâ„ÄÇ
                                            Ëøô‰∫õÊúçÂä°ÂèØËÉΩ‰ºöÊî∂ÈõÜÂíå‰ΩøÁî®ÊÇ®ÁöÑÊï∞ÊçÆ„ÄÇËØ∑ÂãøÂèëÈÄÅÊïèÊÑüÊàñÁßÅÂØÜ‰ø°ÊÅØ„ÄÇ
                                            ÊÇ®ÈúÄË¶ÅËá™Â∑±Êèê‰æõAPIÂØÜÈí•ÔºåÂØÜÈí•Â∞ÜÂÆâÂÖ®Â≠òÂÇ®Âú®Êú¨Âú∞Êï∞ÊçÆÂ∫ì‰∏≠„ÄÇ
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Ê∑ªÂä†Êñ∞ÈÖçÁΩÆ -->
                            <div style="background: #fafafa; border: 1px solid #d9d9d9; border-radius: 6px; padding: 20px; margin-bottom: 24px;">
                                <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600;">‚ûï Ê∑ªÂä†AIÈÖçÁΩÆ</h3>

                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label class="form-label">AIÊúçÂä°ÂïÜ</label>
                                    <select v-model="newAIConfig.provider" @change="onProviderChange" class="ant-input">
                                        <option value="">-- ËØ∑ÈÄâÊã© --</option>
                                        <option v-for="provider in availableProviders" :key="provider.id" :value="provider.id">
                                            {{ provider.name }}
                                        </option>
                                    </select>
                                </div>

                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label class="form-label">Ê®°Âûã</label>
                                    <select v-model="newAIConfig.model" class="ant-input" :disabled="!newAIConfig.provider">
                                        <option value="">-- ËØ∑ÂÖàÈÄâÊã©ÊúçÂä°ÂïÜ --</option>
                                        <option v-for="model in currentProviderModels" :key="model.id" :value="model.id">
                                            {{ model.name }} - {{ model.description }}
                                        </option>
                                    </select>
                                </div>

                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label class="form-label">APIÂØÜÈí•</label>
                                    <input
                                        v-model="newAIConfig.api_key"
                                        type="password"
                                        class="ant-input"
                                        placeholder="ËØ∑ËæìÂÖ•APIÂØÜÈí•"
                                        :disabled="!newAIConfig.provider"
                                    >
                                </div>

                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label class="form-label">Ëá™ÂÆö‰πâAPI Endpoint (ÂèØÈÄâ)</label>
                                    <input
                                        v-model="newAIConfig.base_url"
                                        type="text"
                                        class="ant-input"
                                        placeholder="ÁïôÁ©∫‰ΩøÁî®ÈªòËÆ§Endpoint"
                                    >
                                </div>

                                <div style="display: flex; gap: 12px; margin-top: 20px;">
                                    <button
                                        class="btn-secondary"
                                        @click="testAIConnection"
                                        :disabled="!newAIConfig.provider || !newAIConfig.api_key || testing"
                                    >
                                        {{ testing ? 'ÊµãËØï‰∏≠...' : 'üß™ ÊµãËØïËøûÊé•' }}
                                    </button>
                                    <button
                                        class="btn-primary"
                                        @click="saveAIConfig"
                                        :disabled="!newAIConfig.provider || !newAIConfig.api_key || !newAIConfig.model || saving"
                                    >
                                        {{ saving ? '‰øùÂ≠ò‰∏≠...' : 'üíæ ‰øùÂ≠òÈÖçÁΩÆ' }}
                                    </button>
                                </div>

                                <div v-if="testResult" style="margin-top: 12px; padding: 12px; border-radius: 4px;" :style="{
                                    background: testResult.success ? '#f6ffed' : '#fff2f0',
                                    border: '1px solid ' + (testResult.success ? '#b7eb8f' : '#ffccc7'),
                                    color: testResult.success ? '#52c41a' : '#ff4d4f'
                                }">
                                    {{ testResult.message }}
                                </div>
                            </div>

                            <!-- Â∑≤‰øùÂ≠òÁöÑÈÖçÁΩÆÂàóË°® -->
                            <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600;">üìã Â∑≤‰øùÂ≠òÁöÑÈÖçÁΩÆ</h3>

                            <div v-if="aiConfigs.length === 0" class="empty-state">
                                <div class="empty-icon">üîß</div>
                                <div class="empty-text">ÊöÇÊó†AIÈÖçÁΩÆ</div>
                                <div class="empty-subtext">ËØ∑Âú®‰∏äÊñπÈù¢ÊùøÊ∑ªÂä†AIÊúçÂä°ÈÖçÁΩÆ</div>
                            </div>

                            <div v-else>
                                <div v-for="config in aiConfigs" :key="config.id" style="background: #fff; border: 1px solid #d9d9d9; border-radius: 6px; padding: 16px; margin-bottom: 12px;">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                                        <div>
                                            <div style="font-weight: 600; font-size: 16px; margin-bottom: 4px;">
                                                {{ getProviderName(config.provider) }}
                                                <span v-if="config.is_default" style="background: #52c41a; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-left: 8px;">ÈªòËÆ§</span>
                                            </div>
                                            <div style="color: #8c8c8c; font-size: 13px;">Ê®°Âûã: {{ config.model }}</div>
                                        </div>
                                        <div style="display: flex; gap: 8px;">
                                            <button
                                                v-if="!config.is_default"
                                                class="mini-btn"
                                                @click="setDefaultConfig(config.id)"
                                                title="ËÆæ‰∏∫ÈªòËÆ§"
                                                style="color: var(--primary-color);"
                                            >
                                                ‚≠ê
                                            </button>
                                            <button
                                                class="mini-btn"
                                                @click="deleteAIConfig(config.id)"
                                                title="Âà†Èô§"
                                                style="color: #dc3545; border-color: #dc3545;"
                                            >
                                                üóëÔ∏è
                                            </button>
                                        </div>
                                    </div>
                                    <div style="font-size: 13px; color: #8c8c8c;">
                                        <div v-if="config.last_tested">ÊúÄÂêéÊµãËØï: {{ formatDateTime(config.last_tested) }}</div>
                                        <div v-if="config.test_status">
                                            Áä∂ÊÄÅ: <span :style="{ color: config.test_status === 'success' ? '#52c41a' : '#ff4d4f' }">{{ config.test_status === 'success' ? '‚úì ËøûÊé•ÊàêÂäü' : '‚úó ËøûÊé•Â§±Ë¥•' }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ‰ªªÂä°ËØ¶ÊÉÖ‰æßËæπÊ†è -->
            <div v-if="showDetailPanel" class="detail-panel" :class="{ 'show': showDetailPanel }">
            <div class="detail-header">
                <h3>üìÑ ‰ªªÂä°ËØ¶ÊÉÖ</h3>
                <button class="close-btn" @click="closeDetailPanel">√ó</button>
            </div>

            <div v-if="currentTaskDetail" class="detail-content">
                <!-- Âü∫Êú¨‰ø°ÊÅØ -->
                <div class="detail-section">
                    <h4>üìã Âü∫Êú¨‰ø°ÊÅØ</h4>
                    <div class="detail-item">
                        <label>‰ªªÂä°ID:</label>
                        <span>{{ currentTaskDetail.task_id }}</span>
                    </div>
                    <div class="detail-item">
                        <label>Áä∂ÊÄÅ:</label>
                        <span :class="['status-badge', `status-${currentTaskDetail.status}`]">
                            {{ getStatusText(currentTaskDetail.status) }}
                        </span>
                    </div>
                    <div class="detail-item">
                        <label>ÂàõÂª∫Êó∂Èó¥:</label>
                        <span>{{ formatDateTime(currentTaskDetail.created_at) }}</span>
                    </div>
                    <div v-if="currentTaskDetail.started_at" class="detail-item">
                        <label>ÂºÄÂßãÊó∂Èó¥:</label>
                        <span>{{ formatDateTime(currentTaskDetail.started_at) }}</span>
                    </div>
                    <div v-if="currentTaskDetail.completed_at" class="detail-item">
                        <label>ÂÆåÊàêÊó∂Èó¥:</label>
                        <span>{{ formatDateTime(currentTaskDetail.completed_at) }}</span>
                    </div>
                </div>

                <!-- ÊñáÊú¨ÂÜÖÂÆπ -->
                <div class="detail-section">
                    <h4>üìù ÊñáÊú¨ÂÜÖÂÆπ</h4>
                    <div class="text-content">{{ currentTaskDetail.text }}</div>
                </div>

                <!-- ËØ≠Èü≥ÈÖçÁΩÆ -->
                <div class="detail-section">
                    <h4>üé§ ËØ≠Èü≥ÈÖçÁΩÆ</h4>
                    <div class="detail-item">
                        <label>Â£∞Èü≥:</label>
                        <span>{{ currentTaskDetail.voice }}</span>
                    </div>
                    <div class="detail-item">
                        <label>ËØ≠ÈÄü:</label>
                        <span>{{ currentTaskDetail.rate }}</span>
                    </div>
                    <div class="detail-item">
                        <label>Èü≥Ë∞É:</label>
                        <span>{{ currentTaskDetail.pitch }}</span>
                    </div>
                </div>

                <!-- SSMLÈÖçÁΩÆ -->
                <div v-if="currentTaskDetail.use_ssml" class="detail-section">
                    <h4>üé≠ SSMLÈÖçÁΩÆ</h4>
                    <div class="detail-item">
                        <label>SSMLÊ®°Âºè:</label>
                        <span>ÂêØÁî®</span>
                    </div>
                    <div class="detail-item">
                        <label>È¢ÑËÆæ:</label>
                        <span>{{ currentTaskDetail.ssml_preset || 'Ëá™ÂÆö‰πâ' }}</span>
                    </div>
                    <div v-if="currentTaskDetail.ssml_generated" class="detail-item">
                        <label>ÁîüÊàêÁöÑSSML:</label>
                        <div class="ssml-preview">{{ currentTaskDetail.ssml_generated }}</div>
                    </div>
                </div>

                <!-- Â§ÑÁêÜËøõÂ∫¶ -->
                <div class="detail-section">
                    <h4>üìä Â§ÑÁêÜËøõÂ∫¶</h4>
                    <div class="detail-item">
                        <label>ÊÄªÊÆµÊï∞:</label>
                        <span>{{ currentTaskDetail.total_chunks }}</span>
                    </div>
                    <div class="detail-item">
                        <label>Â∑≤Â§ÑÁêÜ:</label>
                        <span>{{ currentTaskDetail.processed_chunks }}</span>
                    </div>
                    <div v-if="currentTaskDetail.total_chunks > 0" class="progress-bar">
                        <div class="progress-fill" :style="{ width: (currentTaskDetail.processed_chunks / currentTaskDetail.total_chunks * 100) + '%' }"></div>
                    </div>
                </div>

                <!-- Èü≥È¢ëÊñá‰ª∂ -->
                <div v-if="currentTaskDetail.audio_url" class="detail-section">
                    <h4>üéµ Èü≥È¢ëÊñá‰ª∂</h4>
                    <div class="audio-section">
                        <audio :src="getFullAudioUrl(currentTaskDetail.audio_url)" controls class="detail-audio"></audio>
                        <div class="detail-item">
                            <label>Êñá‰ª∂Â§ßÂ∞è:</label>
                            <span>{{ formatFileSize(currentTaskDetail.file_size_bytes) }}</span>
                        </div>
                        <div v-if="currentTaskDetail.duration_seconds" class="detail-item">
                            <label>Êó∂Èïø:</label>
                            <span>{{ currentTaskDetail.duration_seconds }} Áßí</span>
                        </div>
                        <div class="audio-actions">
                            <button class="btn-secondary" @click="downloadAudio(currentTaskDetail.audio_url, currentTaskDetail.task_id)">
                                üíæ ‰∏ãËΩΩÈü≥È¢ë
                            </button>
                            <button class="btn-secondary" @click="showSaveDialog(currentTaskDetail.task_id)">
                                üíæ ‰øùÂ≠òÈü≥È¢ë
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ÈîôËØØ‰ø°ÊÅØ -->
                <div v-if="currentTaskDetail.error_message" class="detail-section error-section">
                    <h4>‚ùå ÈîôËØØ‰ø°ÊÅØ</h4>
                    <div class="error-message">{{ currentTaskDetail.error_message }}</div>
                </div>
            </div>
        </div>

        <!-- Âõ∫ÂÆöÈü≥È¢ëÊí≠ÊîæÂô® -->
        <div v-if="currentAudio" class="fixed-audio-player">
            <audio :src="currentAudio" controls autoplay></audio>
            <button class="close-audio-btn" @click="currentAudio = null">√ó</button>
        </div>

        <!-- ‰øùÂ≠òÈü≥È¢ëÂØπËØùÊ°Ü -->
        <div v-if="showSaveModal" class="modal-overlay" @click.self="showSaveModal = false">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>‰øùÂ≠òÈü≥È¢ë</h3>
                    <button class="close-btn" @click="showSaveModal = false">√ó</button>
                </div>
                <div class="modal-body">
                    <label for="audio-name">Èü≥È¢ëÂêçÁß∞Ôºö</label>
                    <input
                        id="audio-name"
                        v-model="saveAudioName"
                        type="text"
                        class="ant-input"
                        placeholder="ËØ∑ËæìÂÖ•Èü≥È¢ëÂêçÁß∞"
                        @keyup.enter="saveAudio"
                    >
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" @click="showSaveModal = false">ÂèñÊ∂à</button>
                    <button class="btn-primary" @click="saveAudio" :disabled="!saveAudioName.trim()">‰øùÂ≠ò</button>
                </div>
            </div>
        </div>

        <!-- ÂéüÊñáÈ¢ÑËßàÂØπËØùÊ°Ü -->
        <div v-if="showTextPreviewModal" class="modal-overlay" @click.self="showTextPreviewModal = false">
            <div class="modal-content" style="max-width: 800px; max-height: 80vh;">
                <div class="modal-header">
                    <h3>{{ previewTextData.title || 'ÂéüÊñáÈ¢ÑËßà' }}</h3>
                    <button class="close-btn" @click="showTextPreviewModal = false">√ó</button>
                </div>
                <div class="modal-body" style="max-height: 60vh; overflow-y: auto;">
                    <div style="background: #f5f5f5; padding: 16px; border-radius: 6px; white-space: pre-wrap; word-wrap: break-word; line-height: 1.8; font-size: 14px;">{{ previewTextData.text }}</div>
                </div>
                <div class="modal-footer">
                    <div style="flex: 1; color: var(--text-color-secondary); font-size: 13px;">
                        Â≠óÊï∞: {{ previewTextData.text ? previewTextData.text.length.toLocaleString() : 0 }}
                    </div>
                    <button class="btn-secondary" @click="showTextPreviewModal = false">ÂÖ≥Èó≠</button>
                    <button class="btn-primary" @click="downloadText(previewTextData.text, previewTextData.title)">üìÑ ‰∏ãËΩΩÂéüÊñá</button>
                </div>
            </div>
        </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    sidebarCollapsed: false,
                    activeTab: 'create',
                    mode: 'ssml',
                    text: '',
                    creating: false,
                    currentAudio: null,
                    ssmlPreview: '',
                    selectedPreset: 'BEDTIME_BALANCED',
                    selectedTasks: [],
                    ssmlPresets: {},
                    ssmlConfig: {
                        voice: 'zh-CN-XiaoxiaoNeural',
                        style: '',
                        rate: '',
                        pitch: ''
                    },
                    basicConfig: {
                        voice: 'zh-CN-XiaoxiaoNeural',
                        rate: '-15%',
                        pitch: '-2Hz'
                    },
                    tasks: [],
                    refreshInterval: null,
                    showDetailPanel: false,
                    currentTaskDetail: null,
                    savedAudios: [],
                    showSaveModal: false,
                    saveAudioName: '',
                    saveTaskId: null,
                    showTextPreviewModal: false,
                    previewTextData: {
                        text: '',
                        title: ''
                    },
                    // AIÈÖçÁΩÆÁõ∏ÂÖ≥
                    availableProviders: [],
                    aiConfigs: [],
                    newAIConfig: {
                        provider: '',
                        model: '',
                        api_key: '',
                        base_url: ''
                    },
                    testing: false,
                    saving: false,
                    testResult: null,
                    // AIÂàÜÊûêÁõ∏ÂÖ≥
                    analysisResult: null,
                    analyzing: false,
                    analysisProgress: '',
                    characterVoices: {},
                    // ÊåâÊÄßÂà´ÂàÜÁ±ªÁöÑÂ£∞Èü≥Ê±†
                    voicePools: {
                        narration: ['zh-CN-XiaoxiaoNeural', 'zh-CN-XiaoyiNeural', 'zh-CN-XiaohanNeural'],  // ÊóÅÁôΩÁî®Â•≥Â£∞Ôºà‰∏≠ÊÄßÔºâ
                        male: ['zh-CN-YunxiNeural', 'zh-CN-YunjianNeural', 'zh-CN-YunyangNeural',
                               'zh-CN-YunzeNeural', 'zh-CN-YunxiaNeural', 'zh-CN-YunfengNeural',
                               'zh-CN-YunhaoNeural', 'zh-CN-YunjingNeural', 'zh-CN-YunyiNeural'],
                        female: ['zh-CN-XiaoxiaoNeural', 'zh-CN-XiaoyiNeural', 'zh-CN-XiaohanNeural',
                                'zh-CN-XiaomengNeural', 'zh-CN-XiaomoNeural', 'zh-CN-XiaoqiuNeural',
                                'zh-CN-XiaoruiNeural', 'zh-CN-XiaoshuangNeural', 'zh-CN-XiaoyaNeural',
                                'zh-CN-XiaoyanNeural', 'zh-CN-XiaochenNeural', 'zh-CN-YangNeural']
                    },
                    availableVoices: [
                        'zh-CN-XiaoxiaoNeural', 'zh-CN-YunxiNeural', 'zh-CN-YunjianNeural',
                        'zh-CN-XiaoyiNeural', 'zh-CN-YunyangNeural', 'zh-CN-XiaochenNeural',
                        'zh-CN-XiaohanNeural', 'zh-CN-XiaomengNeural', 'zh-CN-XiaomoNeural',
                        'zh-CN-XiaoqiuNeural', 'zh-CN-XiaoruiNeural', 'zh-CN-XiaoshuangNeural',
                        'zh-CN-XiaoyaNeural', 'zh-CN-XiaoyanNeural', 'zh-CN-YangNeural',
                        'zh-CN-YunzeNeural', 'zh-CN-YunxiaNeural', 'zh-CN-YunfengNeural',
                        'zh-CN-YunhaoNeural', 'zh-CN-YunjingNeural', 'zh-CN-YunyiNeural'
                    ]
                };
            },
            mounted() {
                this.loadSSMLPresets();
                this.loadTasks();
                this.loadSavedAudios();
                this.loadAIProviders();
                this.loadAIConfigs();
                this.startAutoRefresh();
            },
            beforeUnmount() {
                if (this.refreshInterval) {
                    clearInterval(this.refreshInterval);
                }
            },
            methods: {
                toggleTaskSelection(taskId) {
                    const index = this.selectedTasks.indexOf(taskId);
                    if (index > -1) {
                        this.selectedTasks.splice(index, 1);
                    } else {
                        this.selectedTasks.push(taskId);
                    }
                },
                toggleSelectAll() {
                    if (this.isAllSelected) {
                        this.selectedTasks = [];
                    } else {
                        this.selectedTasks = this.tasks.map(task => task.task_id);
                    }
                },
                clearSelection() {
                    this.selectedTasks = [];
                },
                async batchDelete() {
                    if (this.selectedTasks.length === 0) return;

                    const count = this.selectedTasks.length;
                    if (!confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§ÈÄâ‰∏≠ÁöÑ ${count} ‰∏™‰ªªÂä°ÂêóÔºü`)) return;

                    try {
                        const deletePromises = this.selectedTasks.map(taskId =>
                            axios.delete(`http://localhost:8000/api/tts/${taskId}`)
                        );

                        await Promise.all(deletePromises);

                        this.showNotification(`ÊàêÂäüÂà†Èô§ ${count} ‰∏™‰ªªÂä°`, 'success');
                        this.selectedTasks = [];
                        await this.loadTasks();
                    } catch (error) {
                        this.showNotification('ÊâπÈáèÂà†Èô§Â§±Ë¥•: ' + (error.response?.data?.detail || error.message), 'error');
                        console.error('Failed to batch delete tasks:', error);
                    }
                },
                handleFileUpload(event) {
                    const file = event.target.files[0];
                    if (!file) return;

                    if (!file.name.endsWith('.txt') && !file.name.endsWith('.md')) {
                        this.showNotification('ËØ∑‰∏ä‰º† .txt Êàñ .md Êñá‰ª∂', 'error');
                        return;
                    }

                    if (file.size > 10 * 1024 * 1024) {
                        this.showNotification('Êñá‰ª∂Â§ßÂ∞è‰∏çËÉΩË∂ÖËøá 10MB', 'error');
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const content = e.target.result;

                            if (!content || content.trim().length === 0) {
                                this.showNotification('Êñá‰ª∂ÂÜÖÂÆπ‰∏∫Á©∫', 'error');
                                return;
                            }

                            this.text = content;

                            const fileSize = (file.size / 1024).toFixed(1);
                            this.showNotification(
                                `Êñá‰ª∂‰∏ä‰º†ÊàêÂäüÔºÅ${file.name} (${fileSize}KB, ${content.length.toLocaleString()} Â≠óÁ¨¶)`,
                                'success'
                            );

                        } catch (error) {
                            this.showNotification('Êñá‰ª∂ËØªÂèñÂ§±Ë¥•: ' + error.message, 'error');
                            console.error('File read error:', error);
                        }
                    };

                    reader.onerror = () => {
                        this.showNotification('Êñá‰ª∂ËØªÂèñÂ§±Ë¥•', 'error');
                    };

                    reader.readAsText(file, 'UTF-8');
                    event.target.value = '';
                },

                async loadSSMLPresets() {
                    try {
                        const response = await axios.get('http://localhost:8000/api/tts/ssml/presets');
                        this.ssmlPresets = response.data.presets;
                    } catch (error) {
                        this.showNotification('Âä†ËΩΩÈ¢ÑËÆæÈÖçÁΩÆÂ§±Ë¥•', 'error');
                        console.error('Failed to load SSML presets:', error);
                    }
                },

                onPresetChange() {
                    this.selectPreset(this.selectedPreset);
                },

                selectPreset(presetName) {
                    this.selectedPreset = presetName;
                    const preset = this.ssmlPresets[presetName];
                    if (preset) {
                        this.ssmlConfig = {
                            voice: preset.voice,
                            style: preset.style || '',
                            rate: preset.rate,
                            pitch: preset.pitch
                        };
                    }
                },

                async previewSSML() {
                    try {
                        const response = await axios.post('http://localhost:8000/api/tts/ssml/preview', {
                            text: this.text,
                            ssml_preset: this.selectedPreset,
                            voice: this.ssmlConfig.voice || undefined,
                            style: this.ssmlConfig.style || undefined,
                            rate: this.ssmlConfig.rate || undefined,
                            pitch: this.ssmlConfig.pitch || undefined
                        });
                        this.ssmlPreview = response.data.ssml;
                    } catch (error) {
                        this.showNotification('È¢ÑËßà SSML Â§±Ë¥•', 'error');
                        console.error('Failed to preview SSML:', error);
                    }
                },

                async createSSMLTask() {
                    if (!this.text.trim()) {
                        this.showNotification('ËØ∑ËæìÂÖ•ÊñáÊú¨ÂÜÖÂÆπ', 'error');
                        return;
                    }

                    this.creating = true;
                    try {
                        const response = await axios.post('http://localhost:8000/api/tts/ssml', {
                            text: this.text,
                            ssml_preset: this.selectedPreset,
                            use_ssml: true,
                            voice: this.ssmlConfig.voice || undefined,
                            style: this.ssmlConfig.style || undefined,
                            rate: this.ssmlConfig.rate || undefined,
                            pitch: this.ssmlConfig.pitch || undefined
                        });

                        this.showNotification('‰ªªÂä°ÂàõÂª∫ÊàêÂäüÔºÅ', 'success');
                        this.text = '';
                        this.ssmlPreview = '';
                        await this.loadTasks();
                    } catch (error) {
                        this.showNotification('ÂàõÂª∫‰ªªÂä°Â§±Ë¥•: ' + (error.response?.data?.detail || error.message), 'error');
                        console.error('Failed to create SSML task:', error);
                    } finally {
                        this.creating = false;
                    }
                },

                async createBasicTask() {
                    if (!this.text.trim()) {
                        this.showNotification('ËØ∑ËæìÂÖ•ÊñáÊú¨ÂÜÖÂÆπ', 'error');
                        return;
                    }

                    this.creating = true;
                    try {
                        const response = await axios.post('http://localhost:8000/api/tts/', {
                            text: this.text,
                            voice: this.basicConfig.voice,
                            rate: this.basicConfig.rate,
                            pitch: this.basicConfig.pitch
                        });

                        this.showNotification('‰ªªÂä°ÂàõÂª∫ÊàêÂäüÔºÅ', 'success');
                        this.text = '';
                        await this.loadTasks();
                    } catch (error) {
                        this.showNotification('ÂàõÂª∫‰ªªÂä°Â§±Ë¥•: ' + (error.response?.data?.detail || error.message), 'error');
                        console.error('Failed to create basic task:', error);
                    } finally {
                        this.creating = false;
                    }
                },

                async loadTasks() {
                    try {
                        const response = await axios.get('http://localhost:8000/api/tts/');
                        this.tasks = response.data.slice(0, 20);
                    } catch (error) {
                        console.error('Failed to load tasks:', error);
                    }
                },

                async refreshTasks() {
                    await this.loadTasks();
                    this.showNotification('‰ªªÂä°ÂàóË°®Â∑≤Âà∑Êñ∞', 'success');
                },

                async refreshTask(taskId) {
                    try {
                        const response = await axios.get(`http://localhost:8000/api/tts/${taskId}`);
                        const taskIndex = this.tasks.findIndex(t => t.task_id === taskId);
                        if (taskIndex !== -1) {
                            this.tasks[taskIndex] = response.data;
                        }
                    } catch (error) {
                        console.error('Failed to refresh task:', error);
                    }
                },

                async loadSavedAudios() {
                    try {
                        const response = await axios.get('http://localhost:8000/api/saved-audios');
                        this.savedAudios = response.data.saved_audios || [];
                    } catch (error) {
                        console.error('Failed to load saved audios:', error);
                    }
                },

                startAutoRefresh() {
                    this.refreshInterval = setInterval(() => {
                        this.loadTasks();
                    }, 5000);
                },

                async viewTaskDetail(taskId) {
                    try {
                        if (this.showDetailPanel && this.currentTaskDetail && this.currentTaskDetail.task_id === taskId) {
                            this.closeDetailPanel();
                            return;
                        }

                        const response = await axios.get(`http://localhost:8000/api/tts/${taskId}`);
                        const task = response.data;

                        let progress = 0;
                        if (task.total_chunks > 0) {
                            progress = task.processed_chunks / task.total_chunks;
                        }

                        this.currentTaskDetail = {
                            ...task,
                            progress: progress
                        };

                        this.showDetailPanel = true;

                    } catch (error) {
                        this.showNotification('Ëé∑Âèñ‰ªªÂä°ËØ¶ÊÉÖÂ§±Ë¥•', 'error');
                        console.error('Failed to get task detail:', error);
                    }
                },

                closeDetailPanel() {
                    this.showDetailPanel = false;
                    setTimeout(() => {
                        this.currentTaskDetail = null;
                    }, 300);
                },

                showSaveDialog(taskId) {
                    this.saveTaskId = taskId;
                    this.saveAudioName = '';
                    this.showSaveModal = true;
                },

                async saveAudio() {
                    if (!this.saveAudioName.trim()) {
                        this.showNotification('ËØ∑ËæìÂÖ•Èü≥È¢ëÂêçÁß∞', 'error');
                        return;
                    }

                    try {
                        await axios.post('http://localhost:8000/api/saved-audios', {
                            task_id: this.saveTaskId,
                            name: this.saveAudioName
                        });

                        this.showNotification('Èü≥È¢ë‰øùÂ≠òÊàêÂäüÔºÅ', 'success');
                        this.showSaveModal = false;
                        this.saveAudioName = '';
                        this.saveTaskId = null;
                        await this.loadSavedAudios();
                    } catch (error) {
                        this.showNotification('‰øùÂ≠òÈü≥È¢ëÂ§±Ë¥•: ' + (error.response?.data?.detail || error.message), 'error');
                    }
                },

                async deleteSavedAudio(audioId) {
                    if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™Èü≥È¢ëÂêóÔºü')) {
                        try {
                            await axios.delete(`http://localhost:8000/api/saved-audios/${audioId}`);
                            this.showNotification('Èü≥È¢ëÂ∑≤Âà†Èô§', 'success');
                            await this.loadSavedAudios();
                        } catch (error) {
                            this.showNotification('Âà†Èô§Èü≥È¢ëÂ§±Ë¥•', 'error');
                            console.error('Failed to delete saved audio:', error);
                        }
                    }
                },

                formatDateTime(dateString) {
                    if (!dateString) return '';

                    try {
                        const date = new Date(dateString);
                        return date.toLocaleString('zh-CN', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit'
                        });
                    } catch (error) {
                        return dateString;
                    }
                },

                formatFileSize(bytes) {
                    if (!bytes) return '0 B';

                    const k = 1024;
                    const sizes = ['B', 'KB', 'MB', 'GB'];
                    const i = Math.floor(Math.log(bytes) / Math.log(k));

                    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                },

                getFullAudioUrl(audioUrl) {
                    return audioUrl && (audioUrl.startsWith('http') ? audioUrl : `http://localhost:8000${audioUrl}`);
                },

                async cancelTask(taskId) {
                    try {
                        await axios.post(`http://localhost:8000/api/tts/${taskId}/cancel`);
                        this.showNotification('‰ªªÂä°Â∑≤ÂèñÊ∂à', 'success');
                        await this.loadTasks();
                    } catch (error) {
                        this.showNotification('ÂèñÊ∂à‰ªªÂä°Â§±Ë¥•', 'error');
                        console.error('Failed to cancel task:', error);
                    }
                },

                playAudio(audioUrl) {
                    const fullAudioUrl = audioUrl.startsWith('http') ? audioUrl : `http://localhost:8000${audioUrl}`;

                    if (this.currentAudio === fullAudioUrl) {
                        this.currentAudio = null;
                    } else {
                        this.currentAudio = fullAudioUrl;
                    }
                },

                async downloadAudio(audioUrl, filename) {
                    // Use the current host for API calls
                    const apiHost = window.location.hostname === 'localhost' ? 'localhost:8000' : window.location.host;
                    const protocol = window.location.protocol;
                    const fullAudioUrl = audioUrl.startsWith('http') ? audioUrl : `${protocol}//${apiHost}${audioUrl}`;

                    try {
                        // Fetch the audio file as a blob to force download
                        const response = await fetch(fullAudioUrl);
                        if (!response.ok) {
                            throw new Error('Failed to fetch audio file');
                        }
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);

                        const link = document.createElement('a');
                        link.href = url;
                        link.download = `${filename}.mp3`;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        window.URL.revokeObjectURL(url);
                    } catch (error) {
                        console.error('Download failed:', error);
                        // Fallback to simple link method
                        const link = document.createElement('a');
                        link.href = fullAudioUrl;
                        link.target = '_blank';
                        link.download = `${filename}.mp3`;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    }
                },

                previewText(text, title) {
                    this.previewTextData = {
                        text: text,
                        title: title
                    };
                    this.showTextPreviewModal = true;
                },

                downloadText(text, filename) {
                    // Create a blob with the text content
                    const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
                    const url = window.URL.createObjectURL(blob);

                    // Create a temporary link and trigger download
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `${filename}.txt`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    window.URL.revokeObjectURL(url);

                    this.showNotification('ÂéüÊñáÂ∑≤‰∏ãËΩΩ', 'success');
                },

                async deleteTask(taskId) {
                    if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™‰ªªÂä°ÂêóÔºü')) {
                        try {
                            await axios.delete(`http://localhost:8000/api/tts/${taskId}`);
                            this.showNotification('‰ªªÂä°Â∑≤Âà†Èô§', 'success');
                            if (this.currentAudio) {
                                this.currentAudio = null;
                            }
                            await this.loadTasks();
                        } catch (error) {
                            this.showNotification('Âà†Èô§‰ªªÂä°Â§±Ë¥•', 'error');
                            console.error('Failed to delete task:', error);
                        }
                    }
                },

                getStatusText(status) {
                    const statusMap = {
                        'pending': 'Á≠âÂæÖ‰∏≠',
                        'processing': 'Â§ÑÁêÜ‰∏≠',
                        'completed': 'Â∑≤ÂÆåÊàê',
                        'failed': 'Â§±Ë¥•',
                        'cancelled': 'Â∑≤ÂèñÊ∂à'
                    };
                    return statusMap[status] || status;
                },

                showNotification(message, type = 'success') {
                    const notification = document.createElement('div');
                    notification.className = `notification ${type}`;
                    notification.textContent = message;
                    document.body.appendChild(notification);

                    setTimeout(() => {
                        notification.remove();
                    }, 3000);
                },

                // AIÈÖçÁΩÆÁõ∏ÂÖ≥ÊñπÊ≥ï
                async loadAIProviders() {
                    try {
                        const response = await axios.get('http://localhost:8000/api/ai-analysis/providers');
                        this.availableProviders = response.data.providers;
                    } catch (error) {
                        console.error('Failed to load AI providers:', error);
                        this.showNotification('Âä†ËΩΩAIÊúçÂä°ÂïÜÂàóË°®Â§±Ë¥•', 'error');
                    }
                },

                async loadAIConfigs() {
                    try {
                        const response = await axios.get('http://localhost:8000/api/ai-analysis/config');
                        this.aiConfigs = response.data.configs || [];
                    } catch (error) {
                        console.error('Failed to load AI configs:', error);
                        this.showNotification('Âä†ËΩΩAIÈÖçÁΩÆÂ§±Ë¥•', 'error');
                    }
                },

                onProviderChange() {
                    // Reset model when provider changes
                    this.newAIConfig.model = '';
                    this.testResult = null;
                },

                getProviderName(providerId) {
                    const provider = this.availableProviders.find(p => p.id === providerId);
                    return provider ? provider.name : providerId;
                },

                async testAIConnection() {
                    console.log('testAIConnection called');
                    console.log('newAIConfig:', this.newAIConfig);

                    if (!this.newAIConfig || !this.newAIConfig.provider) {
                        this.showNotification('ËØ∑ÂÖàÈÄâÊã©AIÊúçÂä°ÂïÜ', 'warning');
                        return;
                    }
                    if (!this.newAIConfig.api_key) {
                        this.showNotification('ËØ∑ËæìÂÖ•APIÂØÜÈí•', 'warning');
                        return;
                    }

                    this.testing = true;
                    this.testResult = null;

                    try {
                        console.log('Sending test request...');
                        // Â§ÑÁêÜbase_urlÔºötrimÁ©∫Ê†ºÔºåÁ©∫Â≠óÁ¨¶‰∏≤ËΩ¨‰∏∫null
                        const baseUrl = this.newAIConfig.base_url ? this.newAIConfig.base_url.trim() : null;
                        const finalBaseUrl = (baseUrl === '') ? null : baseUrl;

                        const response = await axios.post('http://localhost:8000/api/ai-analysis/test-connection', {
                            provider: this.newAIConfig.provider,
                            api_key: this.newAIConfig.api_key,
                            model: this.newAIConfig.model || 'temp',
                            base_url: finalBaseUrl
                        });

                        console.log('Response:', response.data);
                        this.testResult = response.data;
                        this.showNotification(this.testResult.success ? 'ËøûÊé•ÊµãËØïÊàêÂäü' : 'ËøûÊé•ÊµãËØïÂ§±Ë¥•', this.testResult.success ? 'success' : 'error');
                    } catch (error) {
                        console.error('Test connection error:', error);
                        this.testResult = {
                            success: false,
                            message: 'ÊµãËØïËØ∑Ê±ÇÂ§±Ë¥•: ' + (error.response?.data?.detail || error.message)
                        };
                        this.showNotification('ËøûÊé•ÊµãËØïÂ§±Ë¥•', 'error');
                    } finally {
                        this.testing = false;
                    }
                },

                async saveAIConfig() {
                    this.saving = true;

                    try {
                        // Â§ÑÁêÜbase_urlÔºötrimÁ©∫Ê†ºÔºåÁ©∫Â≠óÁ¨¶‰∏≤ËΩ¨‰∏∫null
                        const baseUrl = this.newAIConfig.base_url ? this.newAIConfig.base_url.trim() : null;
                        const finalBaseUrl = (baseUrl === '') ? null : baseUrl;

                        await axios.post('http://localhost:8000/api/ai-analysis/config', {
                            provider: this.newAIConfig.provider,
                            api_key: this.newAIConfig.api_key,
                            model: this.newAIConfig.model,
                            base_url: finalBaseUrl,
                            temperature: '0.7',
                            max_tokens: 4096
                        });

                        this.showNotification('AIÈÖçÁΩÆÂ∑≤‰øùÂ≠ò', 'success');

                        // Reset form
                        this.newAIConfig = {
                            provider: '',
                            model: '',
                            api_key: '',
                            base_url: ''
                        };
                        this.testResult = null;

                        // Reload configs
                        await this.loadAIConfigs();
                    } catch (error) {
                        console.error('Failed to save AI config:', error);
                        this.showNotification('‰øùÂ≠òAIÈÖçÁΩÆÂ§±Ë¥•: ' + (error.response?.data?.detail || error.message), 'error');
                    } finally {
                        this.saving = false;
                    }
                },

                async deleteAIConfig(configId) {
                    if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™AIÈÖçÁΩÆÂêóÔºü')) return;

                    try {
                        await axios.delete(`http://localhost:8000/api/ai-analysis/config/${configId}`);
                        this.showNotification('AIÈÖçÁΩÆÂ∑≤Âà†Èô§', 'success');
                        await this.loadAIConfigs();
                    } catch (error) {
                        console.error('Failed to delete AI config:', error);
                        this.showNotification('Âà†Èô§AIÈÖçÁΩÆÂ§±Ë¥•', 'error');
                    }
                },

                async setDefaultConfig(configId) {
                    try {
                        // This would require an update endpoint, for now just reload
                        this.showNotification('ËÆæ‰∏∫ÈªòËÆ§ÂäüËÉΩÂºÄÂèë‰∏≠', 'info');
                    } catch (error) {
                        console.error('Failed to set default config:', error);
                        this.showNotification('ËÆæÁΩÆÈªòËÆ§ÈÖçÁΩÆÂ§±Ë¥•', 'error');
                    }
                },

                // AIÂàÜÊûêÁõ∏ÂÖ≥ÊñπÊ≥ï
                detectGender(name) {
                    // Ê†πÊçÆÂêçÂ≠óÊ£ÄÊµãÊÄßÂà´ÔºàÁÆÄÂçïËßÑÂàôÔºâ
                    const maleChars = '‰ºüÂàöÂãáÊØÖ‰øäÂ≥∞Âº∫ÂÜõÂπ≥‰øù‰∏úÊñáËæâÂäõÊòéÊ∞∏ÂÅ•‰∏ñÂπøÂøó‰πâÂÖ¥ËâØÊµ∑Â±±‰ªÅÊ≥¢ÂÆÅË¥µÁ¶èÁîüÈæôÂÖÉÂÖ®ÂõΩËÉúÂ≠¶Á••ÊâçÂèëÊ≠¶Êñ∞Âà©Ê∏ÖÈ£ûÂΩ¨ÂØåÈ°∫‰ø°Â≠êÊù∞Ê∂õÊòåÊàêÂ∫∑ÊòüÂÖâÂ§©ËææÂÆâÂ≤©‰∏≠ËåÇËøõÊûóÊúâÂùöÂíåÂΩ™ÂçöËØöÂÖàÊï¨ÈúáÊåØÂ£Æ‰ºöÊÄùÁæ§Ë±™ÂøÉÈÇ¶Êâø‰πêÁªçÂäüÊùæÂñÑÂéöÂ∫ÜÁ£äÊ∞ëÂèãË£ïÊ≤≥Âì≤Ê±üË∂ÖÊµ©‰∫ÆÊîøË∞¶‰∫®Â•áÂõ∫‰πãËΩÆÁø∞Êúó‰ºØÂÆèË®ÄËã•È∏£ÊúãÊñåÊ¢ÅÊ†ãÁª¥ÂêØÂÖã‰º¶ÁøîÊó≠ÈπèÊ≥ΩÊô®Ëæ∞Â£´‰ª•Âª∫ÂÆ∂Ëá¥Ê†ëÁÇéÂæ∑Ë°åÊó∂Ê≥∞ÁõõÈõÑÁêõÈíßÂÜ†Á≠ñËÖæÊ•†Ê¶ïÈ£éËà™Âºò';
                    const femaleChars = 'ÁßÄÂ®üËã±ÂçéÊÖßÂ∑ßÁæéÂ®úÈùôÊ∑ëÊÉ†Áè†Áø†ÈõÖËäùÁéâËêçÁ∫¢Â®•Áé≤Ëä¨Ëä≥ÁáïÂΩ©Êò•ËèäÂÖ∞Âá§Ê¥ÅÊ¢ÖÁê≥Á¥†‰∫ëËé≤ÁúüÁéØÈõ™Ëç£Áà±Â¶πÈúûÈ¶ôÊúàËé∫Â™õËâ≥ÁëûÂá°‰Ω≥ÂòâÁêºÂã§ÁèçË¥ûËéâÊ°ÇÂ®£Âè∂ÁíßÁíêÂ®ÖÁê¶Êô∂Â¶çËåúÁßãÁèäËééÈî¶ÈªõÈùíÂÄ©Â©∑Âß£Â©âÂ®¥ÁëæÈ¢ñÈú≤Áë∂ÊÄ°Â©µÈõÅËììÁ∫®‰ª™Ëç∑‰∏πËìâÁúâÂêõÁê¥ËïäËñáËèÅÊ¢¶Â≤öËãëÂ©ïÈ¶®ÁëóÁê∞ÈüµËûçÂõ≠Ëâ∫ÂíèÂçøËÅ™ÊæúÁ∫ØÊØìÊÇ¶Êò≠ÂÜ∞ÁàΩÁê¨ËåóÁæΩÂ∏åÂÆÅÊ¨£È£òËÇ≤Êª¢È¶•Á≠†ÊüîÁ´πÈú≠ÂáùÊôìÊ¨¢ÈúÑÊû´Ëä∏Ëè≤ÂØí‰ºä‰∫öÂÆúÂèØÂß¨ËàíÂΩ±ËçîÊûùÊÄù‰∏Ω';

                    const lastChar = name.slice(-1);

                    if (maleChars.includes(lastChar)) return 'male';
                    if (femaleChars.includes(lastChar)) return 'female';

                    // Â¶ÇÊûúÊó†Ê≥ïÂà§Êñ≠Ôºå‰ΩøÁî®ÂêØÂèëÂºèËßÑÂàô
                    if (name.includes('ÂÖàÁîü') || name.includes('Áà∏Áà∏') || name.includes('Áà∑Áà∑') || name.includes('‰ºØ') || name.includes('Âèî') || name.includes('Âì•') || name.includes('Âºü')) {
                        return 'male';
                    }
                    if (name.includes('Â•≥Â£´') || name.includes('Â∞èÂßê') || name.includes('Â¶àÂ¶à') || name.includes('Â•∂Â•∂') || name.includes('Âß®') || name.includes('Âßê') || name.includes('Â¶π')) {
                        return 'female';
                    }

                    // ÈªòËÆ§ËøîÂõûÂ•≥ÊÄßÔºàÊõ¥Â∏∏ËßÅÁöÑÊóÅÁôΩÂ£∞Èü≥Ôºâ
                    return 'female';
                },

                autoAssignVoices(characters) {
                    // Ëá™Âä®‰∏∫ËßíËâ≤ÂàÜÈÖçÂ£∞Èü≥
                    const assignment = {};
                    const usedVoices = new Set();

                    // ÊóÅÁôΩÂ£∞Èü≥ÔºàÁ°Æ‰øù‰∏éËßíËâ≤‰∏çÂêåÔºâ
                    let narrationVoice = this.voicePools.narration[0];
                    // Â¶ÇÊûúÊóÅÁôΩÂ£∞Èü≥Â∑≤Ë¢´Âç†Áî®ÔºåÂ∞ùËØïÂÖ∂‰ªñÊóÅÁôΩÂ£∞Èü≥
                    if (usedVoices.has(narrationVoice)) {
                        narrationVoice = this.voicePools.narration.find(v => !usedVoices.has(v)) || narrationVoice;
                    }
                    assignment['_narration'] = narrationVoice;
                    usedVoices.add(narrationVoice);

                    // ÊåâÊÄßÂà´ÂàÜÁªÑËßíËâ≤
                    const maleChars = [];
                    const femaleChars = [];

                    characters.forEach(char => {
                        const gender = this.detectGender(char);
                        if (gender === 'male') {
                            maleChars.push(char);
                        } else {
                            femaleChars.push(char);
                        }
                    });

                    // ‰∏∫Áî∑ÊÄßËßíËâ≤ÂàÜÈÖçÁî∑Â£∞
                    maleChars.forEach((char, index) => {
                        // ‰ªéÁî∑Â£∞Ê±†‰∏≠ÈÄâÊã©Êú™‰ΩøÁî®ÁöÑÂ£∞Èü≥
                        const availableVoices = this.voicePools.male.filter(v => !usedVoices.has(v));
                        if (availableVoices.length > 0) {
                            const voice = availableVoices[index % availableVoices.length];
                            assignment[char] = voice;
                            usedVoices.add(voice);
                        } else {
                            // Â¶ÇÊûúÊ≤°ÊúâÂèØÁî®Áî∑Â£∞Ôºå‰ΩøÁî®ÂÖ∂‰ªñÂ£∞Èü≥
                            const voice = this.voicePools.male[index % this.voicePools.male.length];
                            assignment[char] = voice;
                        }
                    });

                    // ‰∏∫Â•≥ÊÄßËßíËâ≤ÂàÜÈÖçÂ•≥Â£∞ÔºàÈÅøÂÖç‰ΩøÁî®ÊóÅÁôΩÂ£∞Èü≥Ôºâ
                    femaleChars.forEach((char, index) => {
                        // ‰ªéÂ•≥Â£∞Ê±†‰∏≠ÈÄâÊã©Êú™‰ΩøÁî®‰∏î‰∏çÊòØÊóÅÁôΩÁöÑÂ£∞Èü≥
                        const availableVoices = this.voicePools.female.filter(v => !usedVoices.has(v));
                        if (availableVoices.length > 0) {
                            const voice = availableVoices[index % availableVoices.length];
                            assignment[char] = voice;
                            usedVoices.add(voice);
                        } else {
                            // Â¶ÇÊûúÊ≤°ÊúâÂèØÁî®Â•≥Â£∞Ôºå‰ΩøÁî®ÂÖ∂‰ªñÂ£∞Èü≥
                            const voice = this.voicePools.female[index % this.voicePools.female.length];
                            assignment[char] = voice;
                        }
                    });

                    return assignment;
                },

                async analyzeText() {
                    if (!this.text || this.text.trim().length < 100) {
                        this.showNotification('ËØ∑ËæìÂÖ•Ëá≥Â∞ë100Â≠óÁöÑÊñáÊú¨', 'warning');
                        return;
                    }

                    this.analyzing = true;
                    this.analysisProgress = 'Ê≠£Âú®ÂàÜÊûêÊñáÊú¨...';
                    this.analysisResult = null;

                    try {
                        const response = await axios.post('http://localhost:8000/api/ai-analysis/analyze', {
                            text: this.text,
                            enable_dialog_analysis: true,
                            enable_character_extraction: true
                        });

                        this.analysisResult = response.data;

                        if (response.data.status === 'completed') {
                            const characters = Object.keys(response.data.characters || {});
                            this.analysisProgress = `ÂàÜÊûêÂÆåÊàêÔºÅËØÜÂà´Âà∞ ${characters.length} ‰∏™ËßíËâ≤`;

                            // Êô∫ËÉΩËá™Âä®ÂàÜÈÖçÂ£∞Èü≥
                            this.characterVoices = this.autoAssignVoices(characters);

                            // ËÆ∞ÂΩïÂàÜÈÖç‰ø°ÊÅØÂà∞ÊéßÂà∂Âè∞
                            console.log('‚ú® Ëá™Âä®Â£∞Èü≥ÂàÜÈÖç:');
                            Object.entries(this.characterVoices).forEach(([char, voice]) => {
                                const gender = this.detectGender(char);
                                console.log(`  ${char} (${gender}): ${voice}`);
                            });

                            this.showNotification('AIÂàÜÊûêÂÆåÊàêÔºåÂ∑≤Ëá™Âä®ÂàÜÈÖçËßíËâ≤Â£∞Èü≥', 'success');
                        } else {
                            this.showNotification('ÂàÜÊûêÂ§±Ë¥•: ' + (response.data.error || 'Êú™Áü•ÈîôËØØ'), 'error');
                        }
                    } catch (error) {
                        console.error('Failed to analyze text:', error);
                        this.analysisResult = {
                            status: 'failed',
                            error: error.response?.data?.detail || error.message
                        };
                        this.showNotification('AIÂàÜÊûêÂ§±Ë¥•', 'error');
                    } finally {
                        this.analyzing = false;
                    }
                },

                async createMultiVoiceTask() {
                    if (!this.analysisResult || this.analysisResult.status !== 'completed') {
                        this.showNotification('ËØ∑ÂÖàÂÆåÊàêAIÂàÜÊûê', 'warning');
                        return;
                    }

                    if (!this.allCharactersAssigned) {
                        this.showNotification('ËØ∑‰∏∫ÊâÄÊúâËßíËâ≤ÂàÜÈÖçÂ£∞Èü≥', 'warning');
                        return;
                    }

                    this.creating = true;

                    try {
                        // ÊûÑÂª∫Â∏¶ËßíËâ≤‰ø°ÊÅØÁöÑSSMLÔºà‰ΩøÁî®Edge TTSÂ§öËØ≠Èü≥Ê†ºÂºèÔºâ
                        const segments = this.analysisResult.segments || [];

                        // Ëé∑ÂèñÂΩìÂâçÈ¢ÑËÆæÁöÑÂÅúÈ°øËÆæÁΩÆ
                        const preset = this.ssmlPresets[this.selectedPreset] || {};
                        const commaPause = preset.comma_pause || '500ms';
                        const sentencePause = preset.sentence_pause || '1000ms';
                        const paragraphPause = preset.paragraph_pause || '1200ms';
                        const narrationVoice = this.ssmlConfig.voice || 'zh-CN-XiaoxiaoNeural';

                        // ÊûÑÂª∫SSML
                        let ssmlParts = [];
                        ssmlParts.push('<speak version="1.0" xmlns="http://www.w3.org/2001/10/synthesis" xmlns:mstts="https://www.w3.org/2001/mstts" xml:lang="zh-CN">');

                        let currentVoice = null;
                        let currentSegments = [];

                        // ÂêàÂπ∂ËøûÁª≠Áõ∏ÂêåvoiceÁöÑsegments
                        const flushVoice = () => {
                            if (currentVoice && currentSegments.length > 0) {
                                ssmlParts.push(`<voice name="${currentVoice}">`);
                                ssmlParts.push(...currentSegments);
                                ssmlParts.push('</voice>');
                                currentSegments = [];
                            }
                        };

                        for (const segment of segments) {
                            let voice;
                            if (segment.type === 'dialog' && segment.speaker) {
                                voice = this.characterVoices[segment.speaker] || narrationVoice;
                            } else {
                                voice = narrationVoice;
                            }

                            // Â¶ÇÊûúvoiceÊîπÂèòÔºåÂÖàËæìÂá∫‰πãÂâçÁöÑ
                            if (voice !== currentVoice) {
                                flushVoice();
                                currentVoice = voice;
                            }

                            // Ê∑ªÂä†Â∏¶ÂÅúÈ°øÁöÑÂè•Â≠ê
                            if (segment.text.endsWith('Ôºå') || segment.text.endsWith(',')) {
                                currentSegments.push(`<s>${this.escapeXml(segment.text)}<break time="${commaPause}"/></s>`);
                            } else if (segment.text.endsWith('„ÄÇ') || segment.text.endsWith('.') || segment.text.endsWith('ÔºÅ') || segment.text.endsWith('!') || segment.text.endsWith('Ôºü') || segment.text.endsWith('?')) {
                                const pause = segment.type === 'narration' ? paragraphPause : sentencePause;
                                currentSegments.push(`<s>${this.escapeXml(segment.text)}<break time="${pause}"/></s>`);
                            } else {
                                currentSegments.push(`<s>${this.escapeXml(segment.text)}</s>`);
                            }
                        }

                        // ËæìÂá∫ÊúÄÂêéÂâ©‰ΩôÁöÑ
                        flushVoice();

                        ssmlParts.push('</speak>');

                        const ssml = ssmlParts.join('\n');

                        console.log('Multi-voice SSML:', ssml);

                        // ÂàõÂª∫TTS‰ªªÂä° - ‰ΩøÁî®SSML‰Ωú‰∏∫textÔºåÂπ∂Ê∑ªÂä†ÁâπÊÆäÊ†áËÆ∞
                        const response = await axios.post('http://localhost:8000/api/tts/ssml', {
                            text: ssml,  // Áõ¥Êé•ÂèëÈÄÅSSML‰Ωú‰∏∫text
                            use_ssml: true,
                            custom_ssml: true,  // Ê†áËÆ∞‰∏∫Ëá™ÂÆö‰πâSSMLÔºàÂ§öËßíËâ≤Ôºâ
                            voice: this.ssmlConfig.voice,
                            rate: this.ssmlConfig.rate || '-15%',
                            pitch: this.ssmlConfig.pitch || '-2Hz'
                        });

                        this.showNotification('Â§öËßíËâ≤ËØ≠Èü≥‰ªªÂä°Â∑≤ÂàõÂª∫', 'success');
                        this.activeTab = 'tasks';
                        this.analysisResult = null;
                        this.characterVoices = {};
                        this.text = '';
                        await this.loadTasks();
                    } catch (error) {
                        console.error('Failed to create multi-voice task:', error);
                        this.showNotification('ÂàõÂª∫‰ªªÂä°Â§±Ë¥•: ' + (error.response?.data?.detail || error.message), 'error');
                    } finally {
                        this.creating = false;
                    }
                },

                escapeXml(text) {
                    return text
                        .replace(/&/g, '&amp;')
                        .replace(/</g, '&lt;')
                        .replace(/>/g, '&gt;')
                        .replace(/"/g, '&quot;')
                        .replace(/'/g, '&apos;');
                }
            },
            computed: {
                isAllSelected() {
                    return this.tasks.length > 0 && this.selectedTasks.length === this.tasks.length;
                },
                currentProviderModels() {
                    if (!this.newAIConfig || !this.newAIConfig.provider) return [];
                    const provider = this.availableProviders.find(p => p.id === this.newAIConfig.provider);
                    return provider ? provider.models : [];
                },
                hasAIConfig() {
                    return this.aiConfigs && this.aiConfigs.length > 0;
                },
                allCharactersAssigned() {
                    if (!this.analysisResult || !this.analysisResult.characters) return false;
                    const characters = Object.keys(this.analysisResult.characters);
                    return characters.every(char => this.characterVoices[char]);
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
