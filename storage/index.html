<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Voice TTS - Êô∫ËÉΩËØ≠Èü≥ÂêàÊàêÁ≥ªÁªü</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/antd@5.12.8/dist/reset.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/antd@5.12.8/dist/antd.min.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/dayjs.min.js"></script>
    <style>
        :root {
            --primary-color: #1890ff;
            --success-color: #52c41a;
            --warning-color: #faad14;
            --error-color: #ff4d4f;
            --info-color: #13c2c2;
            --text-color: #262626;
            --text-color-secondary: #8c8c8c;
            --border-color: #d9d9d9;
            --background-color: #f5f5f5;
            --white: #ffffff;
            --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            --border-radius: 6px;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f5f5;
            min-height: 100vh;
            color: var(--text-color);
        }

        .app-container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .app-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 16px 24px;
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .app-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--white);
            margin: 0;
        }

        .app-subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            font-weight: 400;
            margin-top: 4px;
        }

        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* ‰æßËæπÊ†èÊ†∑Âºè */
        .sidebar {
            width: 240px;
            background: var(--white);
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            transition: width 0.3s ease;
        }

        .sidebar.collapsed {
            width: 70px;
        }

        .sidebar-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .collapse-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            transition: background-color 0.2s ease;
            font-size: 16px;
            color: var(--text-color-secondary);
        }

        .collapse-btn:hover {
            background-color: #f5f5f5;
            color: var(--primary-color);
        }

        .menu-list {
            list-style: none;
            padding: 16px 0;
            margin: 0;
        }

        .menu-item {
            padding: 12px 24px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-color);
            font-size: 15px;
            font-weight: 500;
            border-left: 3px solid transparent;
            white-space: nowrap;
            overflow: hidden;
        }

        .sidebar.collapsed .menu-item {
            padding: 12px;
            justify-content: center;
        }

        .menu-item:hover {
            background: #f5f5f5;
        }

        .menu-item.active {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            color: var(--primary-color);
            border-left-color: var(--primary-color);
        }

        .menu-icon {
            font-size: 18px;
            min-width: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .menu-text {
            flex: 1;
            opacity: 1;
            transition: opacity 0.2s ease;
        }

        .sidebar.collapsed .menu-text {
            opacity: 0;
            width: 0;
        }

        /* ÂÜÖÂÆπÂå∫ÂüüÊ†∑Âºè */
        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            background: #f5f5f5;
        }

        .content-panel {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 24px;
            box-shadow: var(--box-shadow);
            min-height: 100%;
        }

        .task-list-container {
            display: flex;
            flex-direction: column;
            gap: 0;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .task-list-header {
            display: grid;
            grid-template-columns: 40px 100px 80px 1fr 300px;
            gap: 12px;
            padding: 10px 16px;
            background: #fafafa;
            font-weight: 600;
            font-size: 12px;
            color: var(--text-color);
            border-bottom: 1px solid var(--border-color);
        }

        @media (max-width: 768px) {
            .task-list-header {
                display: none;
            }
        }

        .saved-audio-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
        }

        @media (max-width: 768px) {
            .saved-audio-list {
                grid-template-columns: 1fr;
            }
        }

        .saved-audio-card {
            background: var(--white);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 16px;
            transition: all 0.2s ease;
        }

        .saved-audio-card:hover {
            box-shadow: var(--box-shadow);
            transform: translateY(-2px);
        }

        .audio-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .audio-card-title {
            font-weight: 600;
            font-size: 16px;
            color: var(--text-color);
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .audio-card-meta {
            font-size: 12px;
            color: var(--text-color-secondary);
            margin-bottom: 12px;
        }

        .audio-card-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .audio-card-player {
            width: 100%;
            margin-top: 8px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-color-secondary);
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .empty-text {
            font-size: 16px;
            margin-bottom: 8px;
        }

        .empty-subtext {
            font-size: 14px;
            opacity: 0.7;
        }

        .panel {
            background: transparent;
            border-radius: 0;
            padding: 0;
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .panel-title {
            font-size: 20px;
            font-weight: 600;
            margin: 0;
        }

        .mode-switch {
            display: flex;
            background: var(--background-color);
            border-radius: var(--border-radius);
            padding: 4px;
        }

        .mode-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            color: var(--text-color-secondary);
        }

        .mode-btn.active {
            background: var(--white);
            color: var(--primary-color);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            font-size: 14px;
            color: var(--text-color);
        }

        .ant-input, .ant-select, .ant-input-number, .ant-slider {
            width: 100% !important;
        }

        .text-input {
            min-height: 400px !important;
            resize: vertical;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            line-height: 1.6;
        }

        .text-input.long-text {
            min-height: 500px !important;
            max-height: 700px;
            border-color: var(--warning-color);
            box-shadow: 0 0 0 2px rgba(250, 173, 20, 0.1);
        }

        .text-input.long-text:focus {
            border-color: var(--warning-color);
            box-shadow: 0 0 0 3px rgba(250, 173, 20, 0.2);
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }

        .preset-card {
            padding: 16px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--white);
        }

        .preset-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--box-shadow);
        }

        .preset-card.selected {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--white);
        }

        .preset-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .preset-description {
            font-size: 13px;
            opacity: 0.8;
            line-height: 1.4;
        }

        .preset-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 8px;
            font-size: 12px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
        }

        .advanced-settings {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: var(--white);
            padding: 12px 24px;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: var(--white);
            border: 2px solid var(--border-color);
            color: var(--text-color);
            padding: 10px 20px;
            border-radius: var(--border-radius);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-right: 12px;
        }

        .btn-secondary:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .task-item {
            display: grid;
            grid-template-columns: 40px 100px 80px 1fr 300px;
            gap: 12px;
            padding: 10px 16px;
            background: var(--white);
            border-bottom: 1px solid var(--border-color);
            align-items: center;
            min-height: 44px;
        }

        .task-item.selected {
            background-color: #e6f7ff;
        }

        .task-item:hover {
            background-color: #f5f5f5;
        }

        .task-item.selected:hover {
            background-color: #bae7ff;
        }

        .task-checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: var(--primary-color);
        }

        .batch-actions {
            display: flex;
            gap: 8px;
            padding: 12px 16px;
            background: #fff7e6;
            border-bottom: 1px solid var(--border-color);
            align-items: center;
        }

        .batch-actions.hidden {
            display: none;
        }

        .batch-info {
            font-size: 13px;
            color: var(--text-color);
            font-weight: 500;
        }

        .batch-btn {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--white);
            color: var(--text-color);
            cursor: pointer;
            font-size: 13px;
            transition: all 0.15s ease;
        }

        .batch-btn:hover {
            background: #f0f0f0;
            border-color: #d0d0d0;
        }

        .batch-btn.danger {
            color: #dc3545;
            border-color: #dc3545;
        }

        .batch-btn.danger:hover {
            background: #dc3545;
            color: var(--white);
        }

        .batch-btn.primary {
            color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .batch-btn.primary:hover {
            background: var(--primary-color);
            color: var(--white);
        }

        .task-item:last-child {
            border-bottom: none;
        }

        @media (max-width: 768px) {
            .task-item {
                grid-template-columns: 1fr;
                gap: 8px;
                padding: 12px;
                min-height: auto;
            }
        }

        .task-header {
            display: none;
        }

        .task-id {
            font-family: 'Courier New', monospace;
            font-size: 11px;
            color: var(--primary-color);
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-weight: 600;
            text-align: center;
        }

        .status-badge {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            text-align: center;
            display: inline-block;
        }

        .status-pending {
            background: #fff7e6;
            color: #d46b08;
            border: 1px solid #ffd591;
        }

        .status-processing {
            background: #e6f7ff;
            color: #0958d9;
            border: 1px solid #91d5ff;
        }

        .status-completed {
            background: #f6ffed;
            color: #389e0d;
            border: 1px solid #b7eb8f;
        }

        .status-failed {
            background: #fff2f0;
            color: #d32f2f;
            border: 1px solid #ffccc7;
        }

        .task-text {
            color: var(--text-color);
            font-size: 12px;
            line-height: 1.4;
            overflow: hidden;
        }

        .task-text-content {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .progress-container {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-left: 8px;
        }

        .progress-text {
            font-size: 10px;
            color: var(--primary-color);
            font-weight: 500;
            white-space: nowrap;
        }

        .progress-bar-bg {
            width: 60px;
            height: 3px;
            background: #e0e0e0;
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: var(--primary-color);
            transition: width 0.3s ease;
            border-radius: 2px;
        }

        .task-actions {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        @media (max-width: 768px) {
            .task-actions {
                justify-content: flex-start;
            }
        }

        .mini-btn {
            padding: 4px 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--white);
            min-width: 32px;
            height: 32px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: var(--text-color);
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            transition: all 0.15s ease;
        }

        .mini-btn:hover {
            background: #f0f0f0;
            border-color: #d0d0d0;
        }

        .mini-btn:active {
            background: #e0e0e0;
            border-color: #c0c0c0;
        }

        .mini-btn.active {
            background: #dc3545;
            border-color: #dc3545;
            color: white;
        }

        .mini-btn.active:hover {
            background: #c82333;
            border-color: #c82333;
            color: white;
        }

        .mini-btn.audio {
            border-color: var(--success-color);
            color: var(--success-color);
        }

        .mini-btn.audio:hover {
            background: var(--success-color);
            color: var(--white);
        }

        .ssml-preview {
            background: #f6f8fa;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 16px;
            margin-top: 16px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .audio-player {
            width: 100%;
            margin-top: 12px;
        }

        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: var(--border-radius);
            color: var(--white);
            font-weight: 500;
            box-shadow: var(--box-shadow);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .notification.success {
            background: var(--success-color);
        }

        .notification.error {
            background: var(--error-color);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* ËØ¶ÊÉÖ‰æßËæπÊ†èÊ†∑Âºè */
        .detail-panel {
            position: fixed;
            top: 0;
            left: -50%;
            width: 50%;
            height: 100%;
            background: white;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            transition: left 0.3s ease;
            overflow-y: auto;
        }

        .detail-panel.show {
            left: 0;
        }

        .detail-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .detail-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }

        .close-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .detail-content {
            padding: 20px;
        }

        .detail-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .detail-section:last-child {
            border-bottom: none;
        }

        .detail-section h4 {
            margin: 0 0 15px 0;
            color: var(--primary-color);
            font-size: 16px;
            font-weight: 600;
        }

        .detail-item {
            display: flex;
            margin-bottom: 10px;
            align-items: flex-start;
        }

        .detail-item label {
            font-weight: 500;
            color: var(--text-color-secondary);
            min-width: 80px;
            margin-right: 10px;
        }

        .detail-item span {
            color: var(--text-color);
            flex: 1;
            word-break: break-word;
        }

        .text-content {
            background: var(--bg-color);
            padding: 12px;
            border-radius: var(--border-radius);
            line-height: 1.6;
            max-height: 150px;
            overflow-y: auto;
            font-size: 14px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary-color);
            transition: width 0.3s ease;
        }

        .audio-section {
            text-align: center;
        }

        .detail-audio {
            width: 100%;
            margin-bottom: 15px;
        }

        .audio-actions {
            margin-top: 15px;
        }

        .error-section {
            border-left: 4px solid #e74c3c;
            background: #fdf2f2;
        }

        .error-section h4 {
            color: #e74c3c;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 4px;
            font-size: 14px;
            border: 1px solid #f5c6cb;
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .sidebar {
                width: 60px;
            }

            .sidebar.collapsed {
                width: 60px;
            }

            .sidebar-header {
                display: none;
            }

            .menu-item {
                padding: 12px;
                justify-content: center;
            }

            .menu-text {
                display: none;
            }

            .menu-icon {
                font-size: 20px;
            }

            .content-area {
                padding: 16px;
            }

            .app-title {
                font-size: 18px;
            }

            .app-subtitle {
                display: none;
            }

            .detail-panel {
                width: 100%;
                left: -100%;
            }

            .detail-panel.show {
                left: 0;
            }

            .detail-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .detail-item label {
                margin-bottom: 5px;
            }

            .modal-content {
                width: 90%;
                max-width: none;
            }
        }

        /* Ê®°ÊÄÅÂØπËØùÊ°ÜÊ†∑Âºè */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .modal-content {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
            width: 400px;
            max-width: 90%;
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: var(--text-color);
        }

        .modal-body {
            padding: 24px;
        }

        .modal-body label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .modal-footer .btn-primary {
            width: auto;
        }

        .modal-footer .btn-secondary {
            margin-right: 0;
        }

        /* Âõ∫ÂÆöÈü≥È¢ëÊí≠ÊîæÂô®Ê†∑Âºè */
        .fixed-audio-player {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 9000;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .fixed-audio-player audio {
            width: 300px;
            height: 40px;
        }

        .close-audio-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: #f0f0f0;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            line-height: 1;
            color: #666;
            transition: all 0.2s ease;
        }

        .close-audio-btn:hover {
            background: #e0e0e0;
            color: #333;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="app-container">
            <!-- Â§¥ÈÉ® -->
            <div class="app-header">
                <div>
                    <h1 class="app-title">üéôÔ∏è AI Voice TTS</h1>
                    <p class="app-subtitle">Êô∫ËÉΩËØ≠Èü≥ÂêàÊàêÁ≥ªÁªü - ÊîØÊåÅ SSML È´òÁ∫ßÂäüËÉΩ</p>
                </div>
            </div>

            <!-- ‰∏ªË¶ÅÂÜÖÂÆπÔºö‰æßËæπÊ†è + ÂÜÖÂÆπÂå∫Âüü -->
            <div class="main-content">
                <!-- Â∑¶‰æßËæπÊ†èËèúÂçï -->
                <div class="sidebar" :class="{ collapsed: sidebarCollapsed }">
                    <div class="sidebar-header">
                        <button class="collapse-btn" @click="sidebarCollapsed = !sidebarCollapsed" :title="sidebarCollapsed ? 'Â±ïÂºÄËèúÂçï' : 'ÊäòÂè†ËèúÂçï'">
                            {{ sidebarCollapsed ? '‚ñ∂' : '‚óÄ' }}
                        </button>
                    </div>
                    <ul class="menu-list">
                        <li
                            class="menu-item"
                            :class="{ active: activeTab === 'create' }"
                            @click="activeTab = 'create'"
                            :title="sidebarCollapsed ? 'ÂàõÂª∫‰ªªÂä°' : ''"
                        >
                            <span class="menu-icon">üìù</span>
                            <span class="menu-text">ÂàõÂª∫‰ªªÂä°</span>
                        </li>
                        <li
                            class="menu-item"
                            :class="{ active: activeTab === 'tasks' }"
                            @click="activeTab = 'tasks'"
                            :title="sidebarCollapsed ? '‰ªªÂä°ÂàóË°®' : ''"
                        >
                            <span class="menu-icon">üìã</span>
                            <span class="menu-text">‰ªªÂä°ÂàóË°®</span>
                        </li>
                        <li
                            class="menu-item"
                            :class="{ active: activeTab === 'saved' }"
                            @click="activeTab = 'saved'"
                            :title="sidebarCollapsed ? '‰øùÂ≠òÁöÑÈü≥È¢ë' : ''"
                        >
                            <span class="menu-icon">üíæ</span>
                            <span class="menu-text">‰øùÂ≠òÁöÑÈü≥È¢ë</span>
                        </li>
                    </ul>
                </div>

                <!-- Âè≥‰æßÂÜÖÂÆπÂå∫Âüü -->
                <div class="content-area">
                    <!-- ÂàõÂª∫‰ªªÂä°È°µÈù¢ -->
                    <div v-show="activeTab === 'create'" class="content-panel">
                        <div class="panel">
                            <div class="panel-header">
                                <h2 class="panel-title">üìù ÂàõÂª∫ËØ≠Èü≥‰ªªÂä°</h2>
                                        <div class="mode-switch">
                                            <button
                                                class="mode-btn"
                                                :class="{active: mode === 'ssml'}"
                                                @click="mode = 'ssml'"
                                            >
                                                SSML È´òÁ∫ß
                                            </button>
                                            <button
                                                class="mode-btn"
                                                :class="{active: mode === 'basic'}"
                                                @click="mode = 'basic'"
                                            >
                                                Âü∫Á°ÄÊ®°Âºè
                                            </button>
                                        </div>
                                    </div>

                                    <!-- SSML Ê®°Âºè -->
                                    <div v-if="mode === 'ssml'">
                                        <!-- È¢ÑËÆæÈÄâÊã© -->
                                        <div class="form-group">
                                            <label class="form-label">üéØ ÈÄâÊã©ËØ≠Èü≥È£éÊ†ºÈ¢ÑËÆæ</label>
                                            <div class="preset-buttons">
                                                <div v-for="preset in ssmlPresets"
                                                     :key="preset.name"
                                                     class="preset-card"
                                                     :class="{selected: selectedPreset === preset.name}"
                                                     @click="selectPreset(preset.name)">
                                                    <div class="preset-name">{{ preset.description }}</div>
                                                    <div class="preset-details">
                                                        <div class="detail-item">
                                                            <span>ËØ≠Èü≥:</span>
                                                            <span>{{ preset.voice }}</span>
                                                        </div>
                                                        <div class="detail-item">
                                                            <span>ËØ≠ÈÄü:</span>
                                                            <span>{{ preset.rate }}</span>
                                                        </div>
                                                        <div class="detail-item">
                                                            <span>Èü≥Ë∞É:</span>
                                                            <span>{{ preset.pitch }}</span>
                                                        </div>
                                                        <div class="detail-item">
                                                            <span>ÂÅúÈ°ø:</span>
                                                            <span>{{ preset.comma_pause }} / {{ preset.sentence_pause }}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- È´òÁ∫ßËÆæÁΩÆ -->
                                        <div class="advanced-settings">
                                            <div class="form-group">
                                                <label class="form-label">‚öôÔ∏è È´òÁ∫ßËÆæÁΩÆÔºàË¶ÜÁõñÈ¢ÑËÆæÔºâ</label>
                                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                                    <div>
                                                        <label class="form-label" style="font-size: 12px; color: var(--text-color-secondary);">ËØ≠Èü≥Ê®°Âûã</label>
                                                        <select v-model="ssmlConfig.voice" class="ant-select">
                                                            <option value="zh-CN-XiaoxiaoNeural">ÊôìÊôì Neural</option>
                                                            <option value="zh-CN-YunxiNeural">‰∫ëÂ∏å Neural</option>
                                                            <option value="zh-CN-YunyangNeural">‰∫ëÊâ¨ Neural</option>
                                                        </select>
                                                    </div>
                                                    <div>
                                                        <label class="form-label" style="font-size: 12px; color: var(--text-color-secondary);">ËØ≠Èü≥È£éÊ†º</label>
                                                        <select v-model="ssmlConfig.style" class="ant-select">
                                                            <option value="">ÈªòËÆ§</option>
                                                            <option value="calm">Âπ≥Èùô</option>
                                                            <option value="gentle">Ê∏©Êüî</option>
                                                            <option value="cheerful">Ê¥ªÊ≥º</option>
                                                            <option value="narrator">ËÆ≤Ëø∞ËÄÖ</option>
                                                        </select>
                                                    </div>
                                                    <div>
                                                        <label class="form-label" style="font-size: 12px; color: var(--text-color-secondary);">ËØ≠ÈÄü (Ë¥üÊï∞=ÊÖ¢ÈÄü)</label>
                                                        <input v-model="ssmlConfig.rate" type="text" class="ant-input" placeholder="‰æãÂ¶Ç: -15%">
                                                    </div>
                                                    <div>
                                                        <label class="form-label" style="font-size: 12px; color: var(--text-color-secondary);">Èü≥Ë∞É (Ê≠£Êï∞=È´òÈü≥Ë∞É)</label>
                                                        <input v-model="ssmlConfig.pitch" type="text" class="ant-input" placeholder="‰æãÂ¶Ç: +1%">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ÊñáÊú¨ËæìÂÖ• -->
                                        <div class="form-group">
                                            <label class="form-label">üìñ ËæìÂÖ•ÊñáÊú¨ÂÜÖÂÆπ</label>

                                            <!-- Êñá‰ª∂‰∏ä‰º†ÂíåÂ∑•ÂÖ∑ÊåâÈíÆ -->
                                            <div style="display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
                                                <input
                                                    type="file"
                                                    ref="fileInput"
                                                    @change="handleFileUpload"
                                                    accept=".txt,.md"
                                                    style="display: none;"
                                                >
                                                <button class="btn-secondary" @click="$refs.fileInput.click()" style="font-size: 12px; padding: 4px 12px;">
                                                    üìÅ ‰∏ä‰º†ÊñáÊú¨Êñá‰ª∂
                                                </button>
                                                <button
                                                    class="btn-secondary"
                                                    @click="text = ''"
                                                    style="font-size: 12px; padding: 4px 12px;"
                                                    v-if="text"
                                                >
                                                    üóëÔ∏è Ê∏ÖÁ©∫ÊñáÊú¨
                                                </button>
                                                <div style="margin-left: auto; font-size: 12px; color: var(--text-color-secondary); display: flex; align-items: center; gap: 10px;">
                                                    <span :style="{ color: text.length > 50000 ? 'var(--error-color)' : 'inherit' }">
                                                        Â≠óÁ¨¶Êï∞: {{ text.length.toLocaleString() }}
                                                    </span>
                                                    <span v-if="text.length > 50000" style="color: var(--warning-color);">
                                                        ‚ö†Ô∏è ÈïøÊñáÊú¨Â§ÑÁêÜ‰∏≠
                                                    </span>
                                                </div>
                                            </div>

                                            <textarea
                                                    v-model="text"
                                                    class="ant-input text-input"
                                                    :class="{ 'long-text': text.length > 50000 }"
                                                    placeholder="ËØ∑ËæìÂÖ•Ë¶ÅËΩ¨Êç¢‰∏∫ËØ≠Èü≥ÁöÑÊñáÊú¨ÂÜÖÂÆπ...&#10;&#10;‚úÖ ÊîØÊåÅË∂ÖÈïøÊñáÊú¨ÔºàÂª∫ËÆÆ5‰∏áÂ≠ó‰ª•ÂÜÖÔºâ&#10;‚úÖ Á≥ªÁªü‰ºöËá™Âä®ÂàÜÊÆµÂ§ÑÁêÜ&#10;‚úÖ ÊîØÊåÅ .txt Âíå .md Êñá‰ª∂‰∏ä‰º†">
                                            </textarea>

                                            <!-- ÊñáÊú¨ÁªüËÆ°ÂíåÁä∂ÊÄÅ -->
                                            <div style="margin-top: 8px; font-size: 12px; display: flex; justify-content: space-between; align-items: center;">
                                                <div style="color: var(--text-color-secondary);">
                                                    <span v-if="text.length === 0">ËØ∑ËæìÂÖ•ÊñáÊú¨Êàñ‰∏ä‰º†Êñá‰ª∂</span>
                                                    <span v-else-if="text.length < 1000">Áü≠ÊñáÊú¨ ({{
                                                        Math.ceil(text.length / 200) }}‰∏™Èü≥È¢ëÁâáÊÆµ)</span>
                                                    <span v-else-if="text.length < 10000">‰∏≠Á≠âÊñáÊú¨ ({{
                                                        Math.ceil(text.length / 1000) }}‰∏™Èü≥È¢ëÁâáÊÆµ)</span>
                                                    <span v-else-if="text.length < 50000">ÈïøÊñáÊú¨ ({{
                                                        Math.ceil(text.length / 1000) }}‰∏™Èü≥È¢ëÁâáÊÆµ)</span>
                                                    <span v-else style="color: var(--warning-color); font-weight: bold;">
                                                        Ë∂ÖÈïøÊñáÊú¨ ({{ Math.ceil(text.length / 1000) }}‰∏™Èü≥È¢ëÁâáÊÆµ)
                                                    </span>
                                                </div>
                                                <div style="display: flex; gap: 10px; align-items: center;">
                                                    <span v-if="text.length > 50000" style="color: var(--info-color);">
                                                        üí° Âª∫ËÆÆ‰ΩøÁî®ÂàÜÊÆµÊ®°Âºè
                                                    </span>
                                                    <span v-if="text.length > 100000" style="color: var(--error-color); font-weight: bold;">
                                                        ‚ö†Ô∏è Â§ÑÁêÜÊó∂Èó¥ËæÉÈïø
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- SSML È¢ÑËßà -->
                                        <div class="form-group" v-if="text && selectedPreset">
                                            <button class="btn-secondary" @click="previewSSML">
                                                üëÅÔ∏è È¢ÑËßà SSML
                                            </button>
                                            <div class="ssml-preview" v-if="ssmlPreview">
                                                {{ ssmlPreview }}
                                            </div>
                                        </div>

                                        <!-- ÂàõÂª∫ÊåâÈíÆ -->
                                        <button
                                                class="btn-primary"
                                                @click="createSSMLTask"
                                                :disabled="!text || creating"
                                                :style="{
                                                    backgroundColor: text.length > 50000 ? 'var(--warning-color)' : '',
                                                    borderColor: text.length > 50000 ? 'var(--warning-color)' : ''
                                                }"
                                        >
                                            <span v-if="creating">
                                                <span class="loading-spinner"></span>
                                                <span v-if="text.length > 100000">
                                                    Ê≠£Âú®Â§ÑÁêÜË∂ÖÈïøÊñáÊú¨... (È¢ÑËÆ°ÈúÄË¶ÅËæÉÈïøÊó∂Èó¥)
                                                </span>
                                                <span v-else-if="text.length > 50000">
                                                    Ê≠£Âú®Â§ÑÁêÜÈïøÊñáÊú¨...
                                                </span>
                                                <span v-else>
                                                    Ê≠£Âú®ÂàõÂª∫‰ªªÂä°...
                                                </span>
                                            </span>
                                            <span v-else>
                                                <span v-if="text.length > 100000">
                                                    üöÄ ÂºÄÂßãÂêàÊàêË∂ÖÈïøÊñáÊú¨ ({{ Math.ceil(text.length / 1000) }}ÁâáÊÆµ)
                                                </span>
                                                <span v-else-if="text.length > 50000">
                                                    üöÄ ÂºÄÂßãÂêàÊàêÈïøÊñáÊú¨ ({{ Math.ceil(text.length / 1000) }}ÁâáÊÆµ)
                                                </span>
                                                <span v-else>
                                                    üöÄ ÂºÄÂßãËØ≠Èü≥ÂêàÊàê
                                                </span>
                                            </span>
                                        </button>
                                    </div>

                                    <!-- Âü∫Á°ÄÊ®°Âºè -->
                                    <div v-else>
                                        <!-- ËØ≠Èü≥ÈÄâÊã© -->
                                        <div class="form-group">
                                            <label class="form-label">üé§ ÈÄâÊã©ËØ≠Èü≥Ê®°Âûã</label>
                                            <select v-model="basicConfig.voice" class="ant-select">
                                                <option value="zh-CN-XiaoxiaoNeural">ÊôìÊôì Neural (Â•≥Â£∞)</option>
                                                <option value="zh-CN-YunxiNeural">‰∫ëÂ∏å Neural (Áî∑Â£∞)</option>
                                                <option value="zh-CN-YunyangNeural">‰∫ëÊâ¨ Neural (Áî∑Â£∞)</option>
                                            </select>
                                        </div>

                                        <!-- ËØ≠ÈÄüÂíåÈü≥Ë∞É -->
                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                            <div class="form-group">
                                                <label class="form-label">‚ö° ËØ≠ÈÄü</label>
                                                <input v-model="basicConfig.rate" type="text" class="ant-input" placeholder="‰æãÂ¶Ç: -15%">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">üéµ Èü≥Ë∞É</label>
                                                <input v-model="basicConfig.pitch" type="text" class="ant-input" placeholder="‰æãÂ¶Ç: -2Hz">
                                            </div>
                                        </div>

                                        <!-- ÊñáÊú¨ËæìÂÖ• -->
                                        <div class="form-group">
                                            <label class="form-label">üìñ ËæìÂÖ•ÊñáÊú¨ÂÜÖÂÆπ</label>

                                            <!-- Êñá‰ª∂‰∏ä‰º†ÂíåÂ∑•ÂÖ∑ÊåâÈíÆ -->
                                            <div style="display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
                                                <input
                                                    type="file"
                                                    ref="fileInputBasic"
                                                    @change="handleFileUpload"
                                                    accept=".txt,.md"
                                                    style="display: none;"
                                                >
                                                <button class="btn-secondary" @click="$refs.fileInputBasic.click()" style="font-size: 12px; padding: 4px 12px;">
                                                    üìÅ ‰∏ä‰º†ÊñáÊú¨Êñá‰ª∂
                                                </button>
                                                <button
                                                    class="btn-secondary"
                                                    @click="text = ''"
                                                    style="font-size: 12px; padding: 4px 12px;"
                                                    v-if="text"
                                                >
                                                    üóëÔ∏è Ê∏ÖÁ©∫ÊñáÊú¨
                                                </button>
                                                <div style="margin-left: auto; font-size: 12px; color: var(--text-color-secondary); display: flex; align-items: center; gap: 10px;">
                                                    <span :style="{ color: text.length > 50000 ? 'var(--error-color)' : 'inherit' }">
                                                        Â≠óÁ¨¶Êï∞: {{ text.length.toLocaleString() }}
                                                    </span>
                                                    <span v-if="text.length > 50000" style="color: var(--warning-color);">
                                                        ‚ö†Ô∏è ÈïøÊñáÊú¨Â§ÑÁêÜ‰∏≠
                                                    </span>
                                                </div>
                                            </div>

                                            <textarea
                                                    v-model="text"
                                                    class="ant-input text-input"
                                                    :class="{ 'long-text': text.length > 50000 }"
                                                    placeholder="ËØ∑ËæìÂÖ•Ë¶ÅËΩ¨Êç¢‰∏∫ËØ≠Èü≥ÁöÑÊñáÊú¨ÂÜÖÂÆπ...&#10;&#10;‚úÖ ÊîØÊåÅË∂ÖÈïøÊñáÊú¨ÔºàÂª∫ËÆÆ5‰∏áÂ≠ó‰ª•ÂÜÖÔºâ&#10;‚úÖ Á≥ªÁªü‰ºöËá™Âä®ÂàÜÊÆµÂ§ÑÁêÜ&#10;‚úÖ ÊîØÊåÅ .txt Âíå .md Êñá‰ª∂‰∏ä‰º†">
                                            </textarea>

                                            <!-- ÊñáÊú¨ÁªüËÆ°ÂíåÁä∂ÊÄÅ -->
                                            <div style="margin-top: 8px; font-size: 12px; display: flex; justify-content: space-between; align-items: center;">
                                                <div style="color: var(--text-color-secondary);">
                                                    <span v-if="text.length === 0">ËØ∑ËæìÂÖ•ÊñáÊú¨Êàñ‰∏ä‰º†Êñá‰ª∂</span>
                                                    <span v-else-if="text.length < 1000">Áü≠ÊñáÊú¨ ({{
                                                        Math.ceil(text.length / 200) }}‰∏™Èü≥È¢ëÁâáÊÆµ)</span>
                                                    <span v-else-if="text.length < 10000">‰∏≠Á≠âÊñáÊú¨ ({{
                                                        Math.ceil(text.length / 1000) }}‰∏™Èü≥È¢ëÁâáÊÆµ)</span>
                                                    <span v-else-if="text.length < 50000">ÈïøÊñáÊú¨ ({{
                                                        Math.ceil(text.length / 1000) }}‰∏™Èü≥È¢ëÁâáÊÆµ)</span>
                                                    <span v-else style="color: var(--warning-color); font-weight: bold;">
                                                        Ë∂ÖÈïøÊñáÊú¨ ({{ Math.ceil(text.length / 1000) }}‰∏™Èü≥È¢ëÁâáÊÆµ)
                                                    </span>
                                                </div>
                                                <div style="display: flex; gap: 10px; align-items: center;">
                                                    <span v-if="text.length > 50000" style="color: var(--info-color);">
                                                        üí° Âª∫ËÆÆ‰ΩøÁî®ÂàÜÊÆµÊ®°Âºè
                                                    </span>
                                                    <span v-if="text.length > 100000" style="color: var(--error-color); font-weight: bold;">
                                                        ‚ö†Ô∏è Â§ÑÁêÜÊó∂Èó¥ËæÉÈïø
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ÂàõÂª∫ÊåâÈíÆ -->
                                        <button
                                                class="btn-primary"
                                                @click="createBasicTask"
                                                :disabled="!text || creating"
                                                :style="{
                                                    backgroundColor: text.length > 50000 ? 'var(--warning-color)' : '',
                                                    borderColor: text.length > 50000 ? 'var(--warning-color)' : ''
                                                }"
                                        >
                                            <span v-if="creating">
                                                <span class="loading-spinner"></span>
                                                <span v-if="text.length > 100000">
                                                    Ê≠£Âú®Â§ÑÁêÜË∂ÖÈïøÊñáÊú¨... (È¢ÑËÆ°ÈúÄË¶ÅËæÉÈïøÊó∂Èó¥)
                                                </span>
                                                <span v-else-if="text.length > 50000">
                                                    Ê≠£Âú®Â§ÑÁêÜÈïøÊñáÊú¨...
                                                </span>
                                                <span v-else>
                                                    Ê≠£Âú®ÂàõÂª∫‰ªªÂä°...
                                                </span>
                                            </span>
                                            <span v-else>
                                                <span v-if="text.length > 100000">
                                                    üöÄ ÂºÄÂßãÂêàÊàêË∂ÖÈïøÊñáÊú¨ ({{ Math.ceil(text.length / 1000) }}ÁâáÊÆµ)
                                                </span>
                                                <span v-else-if="text.length > 50000">
                                                    üöÄ ÂºÄÂßãÂêàÊàêÈïøÊñáÊú¨ ({{ Math.ceil(text.length / 1000) }}ÁâáÊÆµ)
                                                </span>
                                                <span v-else>
                                                    üöÄ ÂºÄÂßãËØ≠Èü≥ÂêàÊàê
                                                </span>
                                            </span>
                                        </button>
                                    </div>
                                </div>
                    </div>

                <!-- ‰ªªÂä°ÂàóË°®È°µÈù¢ -->
                <div v-show="activeTab === 'tasks'" class="content-panel">
                        <div class="panel-header">
                            <h2 class="panel-title">üìã ‰ªªÂä°ÂàóË°®</h2>
                                    <button class="btn-secondary" @click="refreshTasks">
                                        üîÑ Âà∑Êñ∞
                                    </button>
                                </div>

                                <div v-if="tasks.length === 0" class="empty-state">
                                    <div class="empty-icon">üì≠</div>
                                    <div class="empty-text">ÊöÇÊó†‰ªªÂä°</div>
                                    <div class="empty-subtext">ÂàõÂª∫ÊÇ®ÁöÑÁ¨¨‰∏Ä‰∏™ËØ≠Èü≥ÂêàÊàê‰ªªÂä°ÂêßÔºÅ</div>
                                </div>

                                <div v-else>
                                    <!-- ÊâπÈáèÊìç‰ΩúÊ†è -->
                                    <div class="batch-actions" :class="{ hidden: selectedTasks.length === 0 }">
                                        <span class="batch-info">Â∑≤ÈÄâÊã© {{ selectedTasks.length }} ‰∏™‰ªªÂä°</span>
                                        <button class="batch-btn danger" @click="batchDelete">
                                            üóëÔ∏è ÊâπÈáèÂà†Èô§
                                        </button>
                                        <button class="batch-btn" @click="clearSelection">
                                            ‚úñÔ∏è ÂèñÊ∂àÈÄâÊã©
                                        </button>
                                    </div>

                                    <div class="task-list-container">
                                        <!-- Ë°®Â§¥ -->
                                        <div class="task-list-header">
                                            <div>
                                                <input
                                                    type="checkbox"
                                                    class="task-checkbox"
                                                    :checked="isAllSelected"
                                                    @change="toggleSelectAll"
                                                    :indeterminate="selectedTasks.length > 0 && !isAllSelected"
                                                >
                                            </div>
                                            <div>‰ªªÂä°ID</div>
                                            <div>Áä∂ÊÄÅ</div>
                                            <div>ÊñáÊú¨ÂÜÖÂÆπ</div>
                                            <div style="text-align: right;">Êìç‰Ωú</div>
                                        </div>

                                        <!-- ‰ªªÂä°ÂàóË°® -->
                                        <div v-for="task in tasks" :key="task.task_id" class="task-item" :class="{ selected: selectedTasks.includes(task.task_id) }">
                                            <div>
                                                <input
                                                        type="checkbox"
                                                        class="task-checkbox"
                                                        :checked="selectedTasks.includes(task.task_id)"
                                                        @change="toggleTaskSelection(task.task_id)"
                                                    >
                                            </div>
                                            <div class="task-id">{{ task.task_id.substring(0, 8) }}</div>
                                            <div :class="['status-badge', `status-${task.status.toLowerCase()}`]">
                                                {{ getStatusText(task.status) }}
                                            </div>
                                        <div class="task-text">
                                            <span class="task-text-content">{{ task.text }}</span>
                                            <span v-if="task.progress && task.status === 'processing'" class="progress-container">
                                                <span class="progress-text">{{ Math.round(task.progress * 100) }}%</span>
                                                <span class="progress-bar-bg">
                                                    <span class="progress-bar-fill" :style="{width: task.progress * 100 + '%'}"></span>
                                                </span>
                                            </span>
                                        </div>
                                        <div class="task-actions">
                                            <button class="mini-btn"
                                                    :class="{ 'active': showDetailPanel && currentTaskDetail && currentTaskDetail.task_id === task.task_id }"
                                                    @click="viewTaskDetail(task.task_id)"
                                                    title="ËØ¶ÊÉÖ">
                                                üìÑ
                                            </button>
                                            <button class="mini-btn" @click="refreshTask(task.task_id)" title="Âà∑Êñ∞">
                                                üîÑ
                                            </button>
                                            <button v-if="task.audio_url" class="mini-btn audio" @click="playAudio(task.audio_url)" title="Êí≠Êîæ">
                                                ‚ñ∂Ô∏è
                                            </button>
                                            <button v-if="task.audio_url" class="mini-btn" @click="downloadAudio(task.audio_url, task.task_id)" title="‰∏ãËΩΩÈü≥È¢ë">
                                                ‚¨áÔ∏è
                                            </button>
                                            <button v-if="task.audio_url && task.status === 'completed'" class="mini-btn" @click="showSaveDialog(task.task_id)" style="color: var(--primary-color); border-color: var(--primary-color);" title="‰øùÂ≠òÂà∞Êî∂Ëóè">
                                                üíæ
                                            </button>
                                            <button v-if="task.status === 'pending' || task.status === 'processing'" class="mini-btn" @click="cancelTask(task.task_id)" title="ÂèñÊ∂à‰ªªÂä°">
                                                ‚ùå
                                            </button>
                                            <button class="mini-btn" @click="deleteTask(task.task_id)" title="Âà†Èô§‰ªªÂä°" style="color: #dc3545; border-color: #dc3545;">
                                                üóëÔ∏è
                                            </button>
                                        </div>
                                    </div>
                                </div>
                    </div>
                </div>

                <!-- ‰øùÂ≠òÁöÑÈü≥È¢ëÈ°µÈù¢ -->
                <div v-show="activeTab === 'saved'" class="content-panel">
                        <!-- Ë∞ÉËØï‰ø°ÊÅØ -->
                        <div style="background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 4px;">
                            <strong>Ë∞ÉËØï‰ø°ÊÅØ:</strong> activeTab = '{{ activeTab }}', savedAudios.length = {{ savedAudios ? savedAudios.length : 0 }}
                        </div>

                        <div class="panel-header">
                            <h2 class="panel-title">üíæ ‰øùÂ≠òÁöÑÈü≥È¢ë</h2>
                            <button class="btn-secondary" @click="loadSavedAudios">
                                üîÑ Âà∑Êñ∞
                            </button>
                        </div>

                        <div v-if="savedAudios.length === 0" class="empty-state">
                            <div class="empty-icon">üéµ</div>
                            <div class="empty-text">ÊöÇÊó†‰øùÂ≠òÁöÑÈü≥È¢ë</div>
                            <div class="empty-subtext">ÂÆåÊàê‰ªªÂä°ÂêéÁÇπÂáª"‰øùÂ≠ò"ÊåâÈíÆÂç≥ÂèØ‰øùÂ≠òÈü≥È¢ë</div>
                        </div>

                        <div v-else class="saved-audio-list">
                            <div v-for="audio in savedAudios" :key="audio.id" class="saved-audio-card">
                                <div class="audio-card-header">
                                    <div class="audio-card-title" :title="audio.name">{{ audio.name }}</div>
                                </div>
                                <div class="audio-card-meta">
                                    <div>‰øùÂ≠òÊó∂Èó¥: {{ formatDateTime(audio.created_at) }}</div>
                                    <div v-if="audio.duration_seconds">Êó∂Èïø: {{ audio.duration_seconds }} Áßí</div>
                                    <div v-if="audio.file_size_bytes">Â§ßÂ∞è: {{ formatFileSize(audio.file_size_bytes) }}</div>
                                </div>
                                <audio :src="getFullAudioUrl(audio.audio_url)" controls class="audio-card-player"></audio>
                                <div class="audio-card-actions">
                                    <button class="mini-btn" @click="playAudio(audio.audio_url)" title="Êí≠Êîæ">
                                        ‚ñ∂Ô∏è
                                    </button>
                                    <button class="mini-btn" @click="downloadAudio(audio.audio_url, audio.name)" title="‰∏ãËΩΩ">
                                        ‚¨áÔ∏è
                                    </button>
                                    <button class="mini-btn" @click="deleteSavedAudio(audio.id)" style="color: #dc3545; border-color: #dc3545;" title="Âà†Èô§">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ‰ªªÂä°ËØ¶ÊÉÖ‰æßËæπÊ†è -->
            <div v-if="showDetailPanel" class="detail-panel" :class="{ 'show': showDetailPanel }">
            <div class="detail-header">
                <h3>üìÑ ‰ªªÂä°ËØ¶ÊÉÖ</h3>
                <button class="close-btn" @click="closeDetailPanel">√ó</button>
            </div>

            <div v-if="currentTaskDetail" class="detail-content">
                <!-- Âü∫Êú¨‰ø°ÊÅØ -->
                <div class="detail-section">
                    <h4>üìã Âü∫Êú¨‰ø°ÊÅØ</h4>
                    <div class="detail-item">
                        <label>‰ªªÂä°ID:</label>
                        <span>{{ currentTaskDetail.task_id }}</span>
                    </div>
                    <div class="detail-item">
                        <label>Áä∂ÊÄÅ:</label>
                        <span :class="['status-badge', `status-${currentTaskDetail.status}`]">
                            {{ getStatusText(currentTaskDetail.status) }}
                        </span>
                    </div>
                    <div class="detail-item">
                        <label>ÂàõÂª∫Êó∂Èó¥:</label>
                        <span>{{ formatDateTime(currentTaskDetail.created_at) }}</span>
                    </div>
                    <div v-if="currentTaskDetail.started_at" class="detail-item">
                        <label>ÂºÄÂßãÊó∂Èó¥:</label>
                        <span>{{ formatDateTime(currentTaskDetail.started_at) }}</span>
                    </div>
                    <div v-if="currentTaskDetail.completed_at" class="detail-item">
                        <label>ÂÆåÊàêÊó∂Èó¥:</label>
                        <span>{{ formatDateTime(currentTaskDetail.completed_at) }}</span>
                    </div>
                </div>

                <!-- ÊñáÊú¨ÂÜÖÂÆπ -->
                <div class="detail-section">
                    <h4>üìù ÊñáÊú¨ÂÜÖÂÆπ</h4>
                    <div class="text-content">{{ currentTaskDetail.text }}</div>
                </div>

                <!-- ËØ≠Èü≥ÈÖçÁΩÆ -->
                <div class="detail-section">
                    <h4>üé§ ËØ≠Èü≥ÈÖçÁΩÆ</h4>
                    <div class="detail-item">
                        <label>Â£∞Èü≥:</label>
                        <span>{{ currentTaskDetail.voice }}</span>
                    </div>
                    <div class="detail-item">
                        <label>ËØ≠ÈÄü:</label>
                        <span>{{ currentTaskDetail.rate }}</span>
                    </div>
                    <div class="detail-item">
                        <label>Èü≥Ë∞É:</label>
                        <span>{{ currentTaskDetail.pitch }}</span>
                    </div>
                </div>

                <!-- SSMLÈÖçÁΩÆ -->
                <div v-if="currentTaskDetail.use_ssml" class="detail-section">
                    <h4>üé≠ SSMLÈÖçÁΩÆ</h4>
                    <div class="detail-item">
                        <label>SSMLÊ®°Âºè:</label>
                        <span>ÂêØÁî®</span>
                    </div>
                    <div class="detail-item">
                        <label>È¢ÑËÆæ:</label>
                        <span>{{ currentTaskDetail.ssml_preset || 'Ëá™ÂÆö‰πâ' }}</span>
                    </div>
                    <div v-if="currentTaskDetail.ssml_generated" class="detail-item">
                        <label>ÁîüÊàêÁöÑSSML:</label>
                        <div class="ssml-preview">{{ currentTaskDetail.ssml_generated }}</div>
                    </div>
                </div>

                <!-- Â§ÑÁêÜËøõÂ∫¶ -->
                <div class="detail-section">
                    <h4>üìä Â§ÑÁêÜËøõÂ∫¶</h4>
                    <div class="detail-item">
                        <label>ÊÄªÊÆµÊï∞:</label>
                        <span>{{ currentTaskDetail.total_chunks }}</span>
                    </div>
                    <div class="detail-item">
                        <label>Â∑≤Â§ÑÁêÜ:</label>
                        <span>{{ currentTaskDetail.processed_chunks }}</span>
                    </div>
                    <div v-if="currentTaskDetail.total_chunks > 0" class="progress-bar">
                        <div class="progress-fill" :style="{ width: (currentTaskDetail.processed_chunks / currentTaskDetail.total_chunks * 100) + '%' }"></div>
                    </div>
                </div>

                <!-- Èü≥È¢ëÊñá‰ª∂ -->
                <div v-if="currentTaskDetail.audio_url" class="detail-section">
                    <h4>üéµ Èü≥È¢ëÊñá‰ª∂</h4>
                    <div class="audio-section">
                        <audio :src="getFullAudioUrl(currentTaskDetail.audio_url)" controls class="detail-audio"></audio>
                        <div class="detail-item">
                            <label>Êñá‰ª∂Â§ßÂ∞è:</label>
                            <span>{{ formatFileSize(currentTaskDetail.file_size_bytes) }}</span>
                        </div>
                        <div v-if="currentTaskDetail.duration_seconds" class="detail-item">
                            <label>Êó∂Èïø:</label>
                            <span>{{ currentTaskDetail.duration_seconds }} Áßí</span>
                        </div>
                        <div class="audio-actions">
                            <button class="btn-secondary" @click="downloadAudio(currentTaskDetail.audio_url, currentTaskDetail.task_id)">
                                üíæ ‰∏ãËΩΩÈü≥È¢ë
                            </button>
                            <button class="btn-secondary" @click="showSaveDialog(currentTaskDetail.task_id)">
                                üíæ ‰øùÂ≠òÈü≥È¢ë
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ÈîôËØØ‰ø°ÊÅØ -->
                <div v-if="currentTaskDetail.error_message" class="detail-section error-section">
                    <h4>‚ùå ÈîôËØØ‰ø°ÊÅØ</h4>
                    <div class="error-message">{{ currentTaskDetail.error_message }}</div>
                </div>
            </div>
        </div>

        <!-- Âõ∫ÂÆöÈü≥È¢ëÊí≠ÊîæÂô® -->
        <div v-if="currentAudio" class="fixed-audio-player">
            <audio :src="currentAudio" controls autoplay></audio>
            <button class="close-audio-btn" @click="currentAudio = null">√ó</button>
        </div>

        <!-- ‰øùÂ≠òÈü≥È¢ëÂØπËØùÊ°Ü -->
        <div v-if="showSaveModal" class="modal-overlay" @click.self="showSaveModal = false">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>‰øùÂ≠òÈü≥È¢ë</h3>
                    <button class="close-btn" @click="showSaveModal = false">√ó</button>
                </div>
                <div class="modal-body">
                    <label for="audio-name">Èü≥È¢ëÂêçÁß∞Ôºö</label>
                    <input
                        id="audio-name"
                        v-model="saveAudioName"
                        type="text"
                        class="ant-input"
                        placeholder="ËØ∑ËæìÂÖ•Èü≥È¢ëÂêçÁß∞"
                        @keyup.enter="saveAudio"
                    >
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" @click="showSaveModal = false">ÂèñÊ∂à</button>
                    <button class="btn-primary" @click="saveAudio" :disabled="!saveAudioName.trim()">‰øùÂ≠ò</button>
                </div>
            </div>
        </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    sidebarCollapsed: false,
                    activeTab: 'create',
                    mode: 'ssml',
                    text: '',
                    creating: false,
                    currentAudio: null,
                    ssmlPreview: '',
                    selectedPreset: 'BEDTIME_BALANCED',
                    selectedTasks: [],
                    ssmlPresets: {},
                    ssmlConfig: {
                        voice: 'zh-CN-XiaoxiaoNeural',
                        style: '',
                        rate: '',
                        pitch: ''
                    },
                    basicConfig: {
                        voice: 'zh-CN-XiaoxiaoNeural',
                        rate: '-15%',
                        pitch: '-2Hz'
                    },
                    tasks: [],
                    refreshInterval: null,
                    showDetailPanel: false,
                    currentTaskDetail: null,
                    savedAudios: [],
                    showSaveModal: false,
                    saveAudioName: '',
                    saveTaskId: null
                };
            },
            mounted() {
                this.loadSSMLPresets();
                this.loadTasks();
                this.loadSavedAudios();
                this.startAutoRefresh();
            },
            beforeUnmount() {
                if (this.refreshInterval) {
                    clearInterval(this.refreshInterval);
                }
            },
            computed: {
                isAllSelected() {
                    return this.tasks.length > 0 && this.selectedTasks.length === this.tasks.length;
                }
            },
            watch: {
                showSaveModal(newVal) {
                    console.log('showSaveModal changed to:', newVal);
                }
            },
            methods: {
                toggleTaskSelection(taskId) {
                    const index = this.selectedTasks.indexOf(taskId);
                    if (index > -1) {
                        this.selectedTasks.splice(index, 1);
                    } else {
                        this.selectedTasks.push(taskId);
                    }
                },
                toggleSelectAll() {
                    if (this.isAllSelected) {
                        this.selectedTasks = [];
                    } else {
                        this.selectedTasks = this.tasks.map(task => task.task_id);
                    }
                },
                clearSelection() {
                    this.selectedTasks = [];
                },
                async batchDelete() {
                    if (this.selectedTasks.length === 0) return;

                    const count = this.selectedTasks.length;
                    if (!confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§ÈÄâ‰∏≠ÁöÑ ${count} ‰∏™‰ªªÂä°ÂêóÔºü`)) return;

                    try {
                        const deletePromises = this.selectedTasks.map(taskId =>
                            axios.delete(`http://localhost:8000/api/tts/${taskId}`)
                        );

                        await Promise.all(deletePromises);

                        this.showNotification(`ÊàêÂäüÂà†Èô§ ${count} ‰∏™‰ªªÂä°`, 'success');
                        this.selectedTasks = [];
                        await this.loadTasks();
                    } catch (error) {
                        this.showNotification('ÊâπÈáèÂà†Èô§Â§±Ë¥•: ' + (error.response?.data?.detail || error.message), 'error');
                        console.error('Failed to batch delete tasks:', error);
                    }
                },
                handleFileUpload(event) {
                    const file = event.target.files[0];
                    if (!file) return;

                    if (!file.name.endsWith('.txt') && !file.name.endsWith('.md')) {
                        this.showNotification('ËØ∑‰∏ä‰º† .txt Êàñ .md Êñá‰ª∂', 'error');
                        return;
                    }

                    if (file.size > 10 * 1024 * 1024) {
                        this.showNotification('Êñá‰ª∂Â§ßÂ∞è‰∏çËÉΩË∂ÖËøá 10MB', 'error');
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const content = e.target.result;

                            if (!content || content.trim().length === 0) {
                                this.showNotification('Êñá‰ª∂ÂÜÖÂÆπ‰∏∫Á©∫', 'error');
                                return;
                            }

                            this.text = content;

                            const fileSize = (file.size / 1024).toFixed(1);
                            this.showNotification(
                                `Êñá‰ª∂‰∏ä‰º†ÊàêÂäüÔºÅ${file.name} (${fileSize}KB, ${content.length.toLocaleString()} Â≠óÁ¨¶)`,
                                'success'
                            );

                        } catch (error) {
                            this.showNotification('Êñá‰ª∂ËØªÂèñÂ§±Ë¥•: ' + error.message, 'error');
                            console.error('File read error:', error);
                        }
                    };

                    reader.onerror = () => {
                        this.showNotification('Êñá‰ª∂ËØªÂèñÂ§±Ë¥•', 'error');
                    };

                    reader.readAsText(file, 'UTF-8');
                    event.target.value = '';
                },

                async loadSSMLPresets() {
                    try {
                        const response = await axios.get('http://localhost:8000/api/tts/ssml/presets');
                        this.ssmlPresets = response.data.presets;
                    } catch (error) {
                        this.showNotification('Âä†ËΩΩÈ¢ÑËÆæÈÖçÁΩÆÂ§±Ë¥•', 'error');
                        console.error('Failed to load SSML presets:', error);
                    }
                },

                selectPreset(presetName) {
                    this.selectedPreset = presetName;
                    const preset = this.ssmlPresets[presetName];
                    if (preset) {
                        this.ssmlConfig = {
                            voice: preset.voice,
                            style: preset.style || '',
                            rate: preset.rate,
                            pitch: preset.pitch
                        };
                    }
                },

                async previewSSML() {
                    try {
                        const response = await axios.post('http://localhost:8000/api/tts/ssml/preview', {
                            text: this.text,
                            ssml_preset: this.selectedPreset,
                            voice: this.ssmlConfig.voice || undefined,
                            style: this.ssmlConfig.style || undefined,
                            rate: this.ssmlConfig.rate || undefined,
                            pitch: this.ssmlConfig.pitch || undefined
                        });
                        this.ssmlPreview = response.data.ssml;
                    } catch (error) {
                        this.showNotification('È¢ÑËßà SSML Â§±Ë¥•', 'error');
                        console.error('Failed to preview SSML:', error);
                    }
                },

                async createSSMLTask() {
                    if (!this.text.trim()) {
                        this.showNotification('ËØ∑ËæìÂÖ•ÊñáÊú¨ÂÜÖÂÆπ', 'error');
                        return;
                    }

                    this.creating = true;
                    try {
                        const response = await axios.post('http://localhost:8000/api/tts/ssml', {
                            text: this.text,
                            ssml_preset: this.selectedPreset,
                            use_ssml: true,
                            voice: this.ssmlConfig.voice || undefined,
                            style: this.ssmlConfig.style || undefined,
                            rate: this.ssmlConfig.rate || undefined,
                            pitch: this.ssmlConfig.pitch || undefined
                        });

                        this.showNotification('‰ªªÂä°ÂàõÂª∫ÊàêÂäüÔºÅ', 'success');
                        this.text = '';
                        this.ssmlPreview = '';
                        await this.loadTasks();
                    } catch (error) {
                        this.showNotification('ÂàõÂª∫‰ªªÂä°Â§±Ë¥•: ' + (error.response?.data?.detail || error.message), 'error');
                        console.error('Failed to create SSML task:', error);
                    } finally {
                        this.creating = false;
                    }
                },

                async createBasicTask() {
                    if (!this.text.trim()) {
                        this.showNotification('ËØ∑ËæìÂÖ•ÊñáÊú¨ÂÜÖÂÆπ', 'error');
                        return;
                    }

                    this.creating = true;
                    try {
                        const response = await axios.post('http://localhost:8000/api/tts/', {
                            text: this.text,
                            voice: this.basicConfig.voice,
                            rate: this.basicConfig.rate,
                            pitch: this.basicConfig.pitch
                        });

                        this.showNotification('‰ªªÂä°ÂàõÂª∫ÊàêÂäüÔºÅ', 'success');
                        this.text = '';
                        await this.loadTasks();
                    } catch (error) {
                        this.showNotification('ÂàõÂª∫‰ªªÂä°Â§±Ë¥•: ' + (error.response?.data?.detail || error.message), 'error');
                        console.error('Failed to create basic task:', error);
                    } finally {
                        this.creating = false;
                    }
                },

                async loadTasks() {
                    try {
                        const response = await axios.get('http://localhost:8000/api/tts/');
                        this.tasks = response.data.slice(0, 20);
                    } catch (error) {
                        console.error('Failed to load tasks:', error);
                    }
                },

                async refreshTasks() {
                    await this.loadTasks();
                    this.showNotification('‰ªªÂä°ÂàóË°®Â∑≤Âà∑Êñ∞', 'success');
                },

                async refreshTask(taskId) {
                    try {
                        const response = await axios.get(`http://localhost:8000/api/tts/${taskId}`);
                        const taskIndex = this.tasks.findIndex(t => t.task_id === taskId);
                        if (taskIndex !== -1) {
                            this.tasks[taskIndex] = response.data;
                        }
                    } catch (error) {
                        console.error('Failed to refresh task:', error);
                    }
                },

                async loadSavedAudios() {
                    console.log('loadSavedAudios called');
                    try {
                        const response = await axios.get('http://localhost:8000/api/saved-audios');
                        console.log('loadSavedAudios response:', response.data);
                        this.savedAudios = response.data.saved_audios || [];
                        console.log('savedAudios set to:', this.savedAudios);
                    } catch (error) {
                        console.error('Failed to load saved audios:', error);
                    }
                },

                startAutoRefresh() {
                    this.refreshInterval = setInterval(() => {
                        this.loadTasks();
                    }, 5000);
                },

                async viewTaskDetail(taskId) {
                    try {
                        if (this.showDetailPanel && this.currentTaskDetail && this.currentTaskDetail.task_id === taskId) {
                            this.closeDetailPanel();
                            return;
                        }

                        const response = await axios.get(`http://localhost:8000/api/tts/${taskId}`);
                        const task = response.data;

                        let progress = 0;
                        if (task.total_chunks > 0) {
                            progress = task.processed_chunks / task.total_chunks;
                        }

                        this.currentTaskDetail = {
                            ...task,
                            progress: progress
                        };

                        this.showDetailPanel = true;

                    } catch (error) {
                        this.showNotification('Ëé∑Âèñ‰ªªÂä°ËØ¶ÊÉÖÂ§±Ë¥•', 'error');
                        console.error('Failed to get task detail:', error);
                    }
                },

                closeDetailPanel() {
                    this.showDetailPanel = false;
                    setTimeout(() => {
                        this.currentTaskDetail = null;
                    }, 300);
                },

                showSaveDialog(taskId) {
                    console.log('showSaveDialog called with taskId:', taskId);
                    this.saveTaskId = taskId;
                    this.saveAudioName = '';
                    this.showSaveModal = true;
                    console.log('showSaveModal set to true, modal should appear');
                },

                async saveAudio() {
                    console.log('saveAudio called', { saveAudioName: this.saveAudioName, saveTaskId: this.saveTaskId });
                    if (!this.saveAudioName.trim()) {
                        this.showNotification('ËØ∑ËæìÂÖ•Èü≥È¢ëÂêçÁß∞', 'error');
                        return;
                    }

                    try {
                        console.log('Sending save request...', { task_id: this.saveTaskId, name: this.saveAudioName });
                        await axios.post('http://localhost:8000/api/saved-audios', {
                            task_id: this.saveTaskId,
                            name: this.saveAudioName
                        });

                        this.showNotification('Èü≥È¢ë‰øùÂ≠òÊàêÂäüÔºÅ', 'success');
                        this.showSaveModal = false;
                        this.saveAudioName = '';
                        this.saveTaskId = null;
                        console.log('Audio saved successfully, reloading saved audios...');
                        await this.loadSavedAudios();
                    } catch (error) {
                        console.error('Failed to save audio:', error);
                        this.showNotification('‰øùÂ≠òÈü≥È¢ëÂ§±Ë¥•: ' + (error.response?.data?.detail || error.message), 'error');
                    }
                },

                async deleteSavedAudio(audioId) {
                    if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™Èü≥È¢ëÂêóÔºü')) {
                        try {
                            await axios.delete(`http://localhost:8000/api/saved-audios/${audioId}`);
                            this.showNotification('Èü≥È¢ëÂ∑≤Âà†Èô§', 'success');
                            await this.loadSavedAudios();
                        } catch (error) {
                            this.showNotification('Âà†Èô§Èü≥È¢ëÂ§±Ë¥•', 'error');
                            console.error('Failed to delete saved audio:', error);
                        }
                    }
                },

                formatDateTime(dateString) {
                    if (!dateString) return '';

                    try {
                        const date = new Date(dateString);
                        return date.toLocaleString('zh-CN', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit'
                        });
                    } catch (error) {
                        return dateString;
                    }
                },

                formatFileSize(bytes) {
                    if (!bytes) return '0 B';

                    const k = 1024;
                    const sizes = ['B', 'KB', 'MB', 'GB'];
                    const i = Math.floor(Math.log(bytes) / Math.log(k));

                    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                },

                getFullAudioUrl(audioUrl) {
                    return audioUrl && (audioUrl.startsWith('http') ? audioUrl : `http://localhost:8000${audioUrl}`);
                },

                async cancelTask(taskId) {
                    try {
                        await axios.post(`http://localhost:8000/api/tts/${taskId}/cancel`);
                        this.showNotification('‰ªªÂä°Â∑≤ÂèñÊ∂à', 'success');
                        await this.loadTasks();
                    } catch (error) {
                        this.showNotification('ÂèñÊ∂à‰ªªÂä°Â§±Ë¥•', 'error');
                        console.error('Failed to cancel task:', error);
                    }
                },

                playAudio(audioUrl) {
                    const fullAudioUrl = audioUrl.startsWith('http') ? audioUrl : `http://localhost:8000${audioUrl}`;

                    if (this.currentAudio === fullAudioUrl) {
                        this.currentAudio = null;
                    } else {
                        this.currentAudio = fullAudioUrl;
                    }
                },

                async downloadAudio(audioUrl, filename) {
                    console.log('downloadAudio called with:', { audioUrl, filename });
                    // Use the current host for API calls
                    const apiHost = window.location.hostname === 'localhost' ? 'localhost:8000' : window.location.host;
                    const protocol = window.location.protocol;
                    const fullAudioUrl = audioUrl.startsWith('http') ? audioUrl : `${protocol}//${apiHost}${audioUrl}`;
                    console.log('Full audio URL:', fullAudioUrl);

                    try {
                        // Fetch the audio file as a blob to force download
                        const response = await fetch(fullAudioUrl);
                        if (!response.ok) {
                            throw new Error('Failed to fetch audio file');
                        }
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);

                        const link = document.createElement('a');
                        link.href = url;
                        link.download = `${filename}.mp3`;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        window.URL.revokeObjectURL(url);
                        console.log('Download completed');
                    } catch (error) {
                        console.error('Download failed:', error);
                        // Fallback to simple link method
                        const link = document.createElement('a');
                        link.href = fullAudioUrl;
                        link.target = '_blank';
                        link.download = `${filename}.mp3`;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    }
                },

                async deleteTask(taskId) {
                    if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™‰ªªÂä°ÂêóÔºü')) {
                        try {
                            await axios.delete(`http://localhost:8000/api/tts/${taskId}`);
                            this.showNotification('‰ªªÂä°Â∑≤Âà†Èô§', 'success');
                            if (this.currentAudio) {
                                this.currentAudio = null;
                            }
                            await this.loadTasks();
                        } catch (error) {
                            this.showNotification('Âà†Èô§‰ªªÂä°Â§±Ë¥•', 'error');
                            console.error('Failed to delete task:', error);
                        }
                    }
                },

                getStatusText(status) {
                    const statusMap = {
                        'pending': 'Á≠âÂæÖ‰∏≠',
                        'processing': 'Â§ÑÁêÜ‰∏≠',
                        'completed': 'Â∑≤ÂÆåÊàê',
                        'failed': 'Â§±Ë¥•',
                        'cancelled': 'Â∑≤ÂèñÊ∂à'
                    };
                    return statusMap[status] || status;
                },

                showNotification(message, type = 'success') {
                    const notification = document.createElement('div');
                    notification.className = `notification ${type}`;
                    notification.textContent = message;
                    document.body.appendChild(notification);

                    setTimeout(() => {
                        notification.remove();
                    }, 3000);
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
